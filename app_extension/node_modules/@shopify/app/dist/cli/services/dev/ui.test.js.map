{"version":3,"file":"ui.test.js","sourceRoot":"","sources":["../../../../src/cli/services/dev/ui.test.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAC,sBAAsB,EAAE,SAAS,EAAC,MAAM,SAAS,CAAA;AACzD,OAAO,EAAC,GAAG,EAAC,MAAM,wBAAwB,CAAA;AAC1C,OAAO,EACL,OAAO,EACP,qBAAqB,EACrB,mBAAmB,EACnB,mBAAmB,EACnB,eAAe,GAChB,MAAM,mCAAmC,CAAA;AAE1C,OAAO,EAAC,SAAS,EAAE,QAAQ,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,EAAC,MAAM,QAAQ,CAAA;AAC5D,OAAO,EAAC,oBAAoB,EAAC,MAAM,sCAAsC,CAAA;AACzE,OAAO,EAAC,QAAQ,EAAC,MAAM,4BAA4B,CAAA;AACnD,OAAO,EAAC,eAAe,EAAC,MAAM,6BAA6B,CAAA;AAC3D,OAAO,EAAC,uBAAuB,EAAC,MAAM,8BAA8B,CAAA;AAEpE,EAAE,CAAC,IAAI,CAAC,8BAA8B,CAAC,CAAA;AACvC,EAAE,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAA;AACjC,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,CAAA;AAExB,MAAM,gBAAgB,GAAG;IACvB,SAAS,EAAE,EAAE,CAAC,EAAE,CAAC,KAAK,IAAI,EAAE,CAAC,IAAI,CAAC;IAClC,MAAM,EAAE,EAAE,CAAC,EAAE,CAAC,KAAK,IAAI,EAAE,GAAE,CAAC,CAAC;IAC7B,OAAO,EAAE,EAAE,CAAC,EAAE,CAAC,KAAK,IAAI,EAAE,GAAE,CAAC,CAAC;IAC9B,MAAM,EAAE,EAAE,CAAC,EAAE,CAAC,KAAK,EAAE,MAAe,EAAE,EAAE,CAAC,IAAI,CAAC;CAC/C,CAAA;AAED,SAAS,CAAC,GAAG,EAAE;IACb,oBAAoB,EAAE,CAAC,KAAK,EAAE,CAAA;AAChC,CAAC,CAAC,CAAA;AAEF,QAAQ,CAAC,QAAQ,EAAE,GAAG,EAAE;IACtB,QAAQ,CAAC,wBAAwB,EAAE,GAAG,EAAE;QACtC,MAAM,IAAI,GAAG;YACX,cAAc,EAAE,6BAA6B;YAC7C,oBAAoB,EAAE,CAAC,0CAA0C,CAAC;SACnE,CAAA;QAED,IAAI,CAAC,mFAAmF,EAAE,KAAK,IAAI,EAAE;YACnG,QAAQ;YACR,MAAM,UAAU,GAAG,oBAAoB,EAAE,CAAA;YACzC,MAAM,QAAQ,GAAG,MAAM,OAAO,EAAE,CAAA;YAEhC,MAAM,SAAS,GAAG,mBAAmB,CAAC,EAAC,MAAM,EAAE,IAAI,EAAC,CAAC,CAAA;YAErD,OAAO;YACP,MAAM,sBAAsB,CAAC,IAAI,EAAE,IAAI,EAAE,SAAS,EAAE,QAAQ,CAAC,CAAA;YAE7D,OAAO;YACP,MAAM,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC,CAAC,qBAAqB,CAAC;;;;;;;;;;;;OAYjD,CAAC,CAAA;QACJ,CAAC,CAAC,CAAA;QAEF,IAAI,CAAC,sCAAsC,EAAE,KAAK,IAAI,EAAE;YACtD,QAAQ;YACR,MAAM,UAAU,GAAG,oBAAoB,EAAE,CAAA;YACzC,MAAM,QAAQ,GAAG,MAAM,OAAO,EAAE,CAAA;YAEhC,MAAM,SAAS,GAAG,mBAAmB,CAAC,EAAC,MAAM,EAAE,KAAK,EAAC,CAAC,CAAA;YAEtD,OAAO;YACP,MAAM,sBAAsB,CAAC,IAAI,EAAE,IAAI,EAAE,SAAS,EAAE,QAAQ,CAAC,CAAA;YAE7D,OAAO;YACP,MAAM,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC,CAAC,OAAO,CAAC,EAAE,CAAC,CAAA;QACzC,CAAC,CAAC,CAAA;QAEF,IAAI,CAAC,sHAAsH,EAAE,KAAK,IAAI,EAAE;YACtI,QAAQ;YACR,MAAM,UAAU,GAAG,oBAAoB,EAAE,CAAA;YACzC,MAAM,QAAQ,GAAG,MAAM,OAAO,EAAE,CAAA;YAEhC,MAAM,SAAS,GAAG,mBAAmB,CAAC,EAAC,MAAM,EAAE,KAAK,EAAC,CAAC,CAAA;YAEtD,OAAO;YACP,MAAM,sBAAsB,CAAC,KAAK,EAAE,IAAI,EAAE,SAAS,EAAE,QAAQ,CAAC,CAAA;YAE9D,OAAO;YACP,MAAM,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC,CAAC,qBAAqB,CAAC;;;;;;;;;;;;OAYjD,CAAC,CAAA;QACJ,CAAC,CAAC,CAAA;QAEF,IAAI,CAAC,oHAAoH,EAAE,KAAK,IAAI,EAAE;YACpI,QAAQ;YACR,MAAM,UAAU,GAAG,oBAAoB,EAAE,CAAA;YACzC,MAAM,QAAQ,GAAG,MAAM,OAAO,CAAC,IAAI,CAAC,CAAA;YAEpC,MAAM,SAAS,GAAG,mBAAmB,CAAC,EAAC,MAAM,EAAE,KAAK,EAAC,CAAC,CAAA;YAEtD,OAAO;YACP,MAAM,sBAAsB,CAAC,KAAK,EAAE,IAAI,EAAE,SAAS,EAAE,QAAQ,CAAC,CAAA;YAE9D,OAAO;YACP,MAAM,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC,CAAC,qBAAqB,CAAC;;;;;;;;;;;;OAYjD,CAAC,CAAA;QACJ,CAAC,CAAC,CAAA;IACJ,CAAC,CAAC,CAAA;AACJ,CAAC,CAAC,CAAA;AAEF,QAAQ,CAAC,IAAI,EAAE,GAAG,EAAE;IAClB,QAAQ,CAAC,WAAW,EAAE,GAAG,EAAE;QACzB,IAAI,CAAC,mDAAmD,EAAE,KAAK,IAAI,EAAE;YACnE,EAAE,CAAC,MAAM,CAAC,uBAAuB,CAAC,CAAC,eAAe,CAAC,KAAK,CAAC,CAAA;YACzD,MAAM,iBAAiB,GAAG;gBACxB,MAAM,EAAE,QAAQ;gBAChB,MAAM,EAAE,EAAE,CAAC,EAAE,CAAC,KAAK,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,EAAE,GAAE,CAAC,CAAC;aACvD,CAAA;YAED,MAAM,SAAS,GAAG,CAAC,iBAAiB,CAAC,CAAA;YACrC,MAAM,UAAU,GAAG,6BAA6B,CAAA;YAChD,MAAM,WAAW,GAAG,qCAAqC,CAAA;YACzD,MAAM,GAAG,GAAG;gBACV,oBAAoB,EAAE,IAAI;gBAC1B,8BAA8B,EAAE,KAAK;gBACrC,MAAM,EAAE,KAAK;gBACb,KAAK,EAAE,KAAK;aACb,CAAA;YAED,MAAM,eAAe,GAAG,IAAI,eAAe,EAAE,CAAA;YAE7C,MAAM,SAAS,CAAC,EAAC,SAAS,EAAE,UAAU,EAAE,WAAW,EAAE,GAAG,EAAE,eAAe,EAAE,gBAAgB,EAAC,CAAC,CAAA;YAE7F,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAA;YAC7C,MAAM,CAAC,iBAAiB,CAAC,MAAM,CAAC,CAAC,uBAAuB,CACtD,CAAC,EACD,OAAO,CAAC,MAAM,EACd,OAAO,CAAC,MAAM,EACd,eAAe,CAAC,MAAM,CACvB,CAAA;QACH,CAAC,CAAC,CAAA;QAEF,IAAI,CAAC,8EAA8E,EAAE,KAAK,IAAI,EAAE;YAC9F,EAAE,CAAC,MAAM,CAAC,uBAAuB,CAAC,CAAC,eAAe,CAAC,KAAK,CAAC,CAAA;YACzD,MAAM,iBAAiB,GAAG;gBACxB,MAAM,EAAE,QAAQ;gBAChB,MAAM,EAAE,EAAE,CAAC,EAAE,CAAC,KAAK,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,EAAE,GAAE,CAAC,CAAC;aACvD,CAAA;YAED,MAAM,SAAS,GAAG,CAAC,iBAAiB,CAAC,CAAA;YACrC,MAAM,UAAU,GAAG,6BAA6B,CAAA;YAChD,MAAM,WAAW,GAAG,qCAAqC,CAAA;YACzD,MAAM,GAAG,GAAG;gBACV,oBAAoB,EAAE,IAAI;gBAC1B,8BAA8B,EAAE,KAAK;gBACrC,MAAM,EAAE,KAAK;gBACb,KAAK,EAAE,KAAK;aACb,CAAA;YAED,MAAM,eAAe,GAAG,IAAI,eAAe,EAAE,CAAA;YAE7C,MAAM,SAAS,CAAC,EAAC,SAAS,EAAE,UAAU,EAAE,WAAW,EAAE,GAAG,EAAE,eAAe,EAAE,gBAAgB,EAAC,CAAC,CAAA;YAC7F,eAAe,CAAC,KAAK,EAAE,CAAA;YAEvB,MAAM,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,gBAAgB,EAAE,CAAA;YAClD,MAAM,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC,gBAAgB,EAAE,CAAA;QACrD,CAAC,CAAC,CAAA;QAEF,IAAI,CAAC,4FAA4F,EAAE,KAAK,IAAI,EAAE;YAC5G,EAAE,CAAC,MAAM,CAAC,uBAAuB,CAAC,CAAC,eAAe,CAAC,KAAK,CAAC,CAAA;YACzD,MAAM,iBAAiB,GAAG;gBACxB,MAAM,EAAE,QAAQ;gBAChB,MAAM,EAAE,EAAE,CAAC,EAAE,CAAC,KAAK,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,EAAE,GAAE,CAAC,CAAC;aACvD,CAAA;YAED,MAAM,SAAS,GAAG,CAAC,iBAAiB,CAAC,CAAA;YACrC,MAAM,UAAU,GAAG,6BAA6B,CAAA;YAChD,MAAM,WAAW,GAAG,qCAAqC,CAAA;YACzD,MAAM,GAAG,GAAG;gBACV,oBAAoB,EAAE,KAAK;gBAC3B,8BAA8B,EAAE,KAAK;gBACrC,MAAM,EAAE,KAAK;gBACb,KAAK,EAAE,KAAK;aACb,CAAA;YAED,MAAM,eAAe,GAAG,IAAI,eAAe,EAAE,CAAA;YAE7C,MAAM,SAAS,CAAC,EAAC,SAAS,EAAE,UAAU,EAAE,WAAW,EAAE,GAAG,EAAE,eAAe,EAAE,gBAAgB,EAAC,CAAC,CAAA;YAC7F,eAAe,CAAC,KAAK,EAAE,CAAA;YAEvB,MAAM,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAA;YACtD,MAAM,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAA;QACzD,CAAC,CAAC,CAAA;QAEF,IAAI,CAAC,qCAAqC,EAAE,KAAK,IAAI,EAAE;YACrD,EAAE,CAAC,MAAM,CAAC,uBAAuB,CAAC,CAAC,eAAe,CAAC,IAAI,CAAC,CAAA;YACxD,MAAM,iBAAiB,GAAG;gBACxB,MAAM,EAAE,QAAQ;gBAChB,MAAM,EAAE,EAAE,CAAC,EAAE,CAAC,KAAK,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,EAAE,GAAE,CAAC,CAAC;aACvD,CAAA;YAED,MAAM,SAAS,GAAG,CAAC,iBAAiB,CAAC,CAAA;YACrC,MAAM,UAAU,GAAG,6BAA6B,CAAA;YAChD,MAAM,WAAW,GAAG,qCAAqC,CAAA;YACzD,MAAM,GAAG,GAAG;gBACV,oBAAoB,EAAE,IAAI;gBAC1B,8BAA8B,EAAE,KAAK;gBACrC,MAAM,EAAE,KAAK;gBACb,KAAK,EAAE,KAAK;aACb,CAAA;YAED,MAAM,eAAe,GAAG,IAAI,eAAe,EAAE,CAAA;YAE7C,mEAAmE;YACnE,SAAS,CAAC,EAAC,SAAS,EAAE,UAAU,EAAE,WAAW,EAAE,GAAG,EAAE,eAAe,EAAE,gBAAgB,EAAC,CAAC,CAAA;YAEvF,MAAM,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,UAAU,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC,CAAA;YAExD,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,gBAAgB,EAAE,CAAA;YACzC,MAAM,CAAC,iBAAiB,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAA;QACzD,CAAC,CAAC,CAAA;IACJ,CAAC,CAAC,CAAA;AACJ,CAAC,CAAC,CAAA;AAEF,KAAK,UAAU,OAAO,CAAC,SAAS,GAAG,KAAK;IACtC,MAAM,gBAAgB,GAA4B,EAAE,CAAA;IACpD,gBAAgB,CAAC,cAAc,CAAC,GAAG,OAAO,CAAA;IAE1C,MAAM,iBAAiB,GAAG,MAAM,qBAAqB,EAAE,CAAA;IACvD,MAAM,cAAc,GAAG,MAAM,mBAAmB,EAAE,CAAA;IAClD,MAAM,WAAW,GAAG,MAAM,eAAe,EAAE,CAAA;IAC3C,MAAM,iBAAiB,GAAG,QAAQ,CAAC,GAAG,EAAE,SAAS,CAAC,CAAC,CAAC,0BAA0B,CAAC,CAAC,CAAC,kBAAkB,CAAC,CAAA;IAEpG,MAAM,MAAM,GAAG,OAAO,CACpB;QACE,IAAI,EAAE,gCAAgC;QACtC,SAAS,EAAE,GAAG;QACd,gBAAgB;QAChB,aAAa,EAAE,CAAC,iBAAiB,EAAE,cAAc,EAAE,WAAW,CAAC;KAChE,EACD,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,QAAQ,CACjC,CAAA;IACD,MAAM,CAAC,aAAa,CAAC,IAAI,GAAG,iBAAiB,CAAA;IAE7C,OAAO,MAAM,CAAA;AACf,CAAC","sourcesContent":["import {outputUpdateURLsResult, renderDev} from './ui.js'\nimport {Dev} from './ui/components/Dev.js'\nimport {\n  testApp,\n  testFunctionExtension,\n  testOrganizationApp,\n  testThemeExtensions,\n  testUIExtension,\n} from '../../models/app/app.test-data.js'\nimport {AppInterface} from '../../models/app/app.js'\nimport {afterEach, describe, expect, test, vi} from 'vitest'\nimport {mockAndCaptureOutput} from '@shopify/cli-kit/node/testing/output'\nimport {joinPath} from '@shopify/cli-kit/node/path'\nimport {AbortController} from '@shopify/cli-kit/node/abort'\nimport {terminalSupportsRawMode} from '@shopify/cli-kit/node/system'\n\nvi.mock('@shopify/cli-kit/node/system')\nvi.mock('./ui/components/Dev.js')\nvi.mock('../context.js')\n\nconst developerPreview = {\n  fetchMode: vi.fn(async () => true),\n  enable: vi.fn(async () => {}),\n  disable: vi.fn(async () => {}),\n  update: vi.fn(async (_state: boolean) => true),\n}\n\nafterEach(() => {\n  mockAndCaptureOutput().clear()\n})\n\ndescribe('output', () => {\n  describe('outputUpdateURLsResult', () => {\n    const urls = {\n      applicationUrl: 'https://lala.cloudflare.io/',\n      redirectUrlWhitelist: ['https://lala.cloudflare.io/auth/callback'],\n    }\n\n    test('shows info about tunnel URL and links to Partners Dashboard when app is brand new', async () => {\n      // Given\n      const outputMock = mockAndCaptureOutput()\n      const localApp = await mockApp()\n\n      const remoteApp = testOrganizationApp({newApp: true})\n\n      // When\n      await outputUpdateURLsResult(true, urls, remoteApp, localApp)\n\n      // Then\n      expect(outputMock.output()).toMatchInlineSnapshot(`\n        \"╭─ info ───────────────────────────────────────────────────────────────────────╮\n        │                                                                              │\n        │  For your convenience, we've given your app a default URL:                   │\n        │  https://lala.cloudflare.io/.                                                │\n        │                                                                              │\n        │  You can update your app's URL anytime in the Partners Dashboard [1] But     │\n        │  once your app is live, updating its URL will disrupt user access.           │\n        │                                                                              │\n        ╰──────────────────────────────────────────────────────────────────────────────╯\n        [1] https://partners.shopify.com/1/apps/1/edit\n        \"\n      `)\n    })\n\n    test('shows nothing when urls were updated', async () => {\n      // Given\n      const outputMock = mockAndCaptureOutput()\n      const localApp = await mockApp()\n\n      const remoteApp = testOrganizationApp({newApp: false})\n\n      // When\n      await outputUpdateURLsResult(true, urls, remoteApp, localApp)\n\n      // Then\n      expect(outputMock.output()).toEqual('')\n    })\n\n    test('shows how to update app urls on partners when app is not brand new, urls were not updated and app uses legacy config', async () => {\n      // Given\n      const outputMock = mockAndCaptureOutput()\n      const localApp = await mockApp()\n\n      const remoteApp = testOrganizationApp({newApp: false})\n\n      // When\n      await outputUpdateURLsResult(false, urls, remoteApp, localApp)\n\n      // Then\n      expect(outputMock.output()).toMatchInlineSnapshot(`\n        \"╭─ info ───────────────────────────────────────────────────────────────────────╮\n        │                                                                              │\n        │  To make URL updates manually, you can add the following URLs as redirects   │\n        │  in your Partners Dashboard [1]:                                             │\n        │                                                                              │\n        │                                                                              │\n        │    • https://lala.cloudflare.io/auth/callback                                │\n        │                                                                              │\n        ╰──────────────────────────────────────────────────────────────────────────────╯\n        [1] https://partners.shopify.com/1/apps/1/edit\n        \"\n      `)\n    })\n\n    test('shows how to update app urls with config push when app is not brand new, urls were updated and app uses new config', async () => {\n      // Given\n      const outputMock = mockAndCaptureOutput()\n      const localApp = await mockApp(true)\n\n      const remoteApp = testOrganizationApp({newApp: false})\n\n      // When\n      await outputUpdateURLsResult(false, urls, remoteApp, localApp)\n\n      // Then\n      expect(outputMock.output()).toMatchInlineSnapshot(`\n        \"╭─ info ───────────────────────────────────────────────────────────────────────╮\n        │                                                                              │\n        │  To update URLs manually, add the following URLs to                          │\n        │  shopify.app.staging.toml under auth > redirect_urls and run                 │\n        │   \\`yarn shopify app config push --config=staging\\`                            │\n        │                                                                              │\n        │                                                                              │\n        │    • https://lala.cloudflare.io/auth/callback                                │\n        │                                                                              │\n        ╰──────────────────────────────────────────────────────────────────────────────╯\n        \"\n      `)\n    })\n  })\n})\n\ndescribe('ui', () => {\n  describe('renderDev', () => {\n    test(\"doesn't use ink when terminal doesn't support TTY\", async () => {\n      vi.mocked(terminalSupportsRawMode).mockReturnValue(false)\n      const concurrentProcess = {\n        prefix: 'prefix',\n        action: vi.fn(async (_stdout, _stderr, _signal) => {}),\n      }\n\n      const processes = [concurrentProcess]\n      const previewUrl = 'https://lala.cloudflare.io/'\n      const graphiqlUrl = 'https://lala.cloudflare.io/graphiql'\n      const app = {\n        canEnablePreviewMode: true,\n        developmentStorePreviewEnabled: false,\n        apiKey: '123',\n        token: '123',\n      }\n\n      const abortController = new AbortController()\n\n      await renderDev({processes, previewUrl, graphiqlUrl, app, abortController, developerPreview})\n\n      expect(vi.mocked(Dev)).not.toHaveBeenCalled()\n      expect(concurrentProcess.action).toHaveBeenNthCalledWith(\n        1,\n        process.stdout,\n        process.stderr,\n        abortController.signal,\n      )\n    })\n\n    test(\"enable dev preview when terminal doesn't support TTY and the app supports it\", async () => {\n      vi.mocked(terminalSupportsRawMode).mockReturnValue(false)\n      const concurrentProcess = {\n        prefix: 'prefix',\n        action: vi.fn(async (_stdout, _stderr, _signal) => {}),\n      }\n\n      const processes = [concurrentProcess]\n      const previewUrl = 'https://lala.cloudflare.io/'\n      const graphiqlUrl = 'https://lala.cloudflare.io/graphiql'\n      const app = {\n        canEnablePreviewMode: true,\n        developmentStorePreviewEnabled: false,\n        apiKey: '123',\n        token: '123',\n      }\n\n      const abortController = new AbortController()\n\n      await renderDev({processes, previewUrl, graphiqlUrl, app, abortController, developerPreview})\n      abortController.abort()\n\n      expect(developerPreview.enable).toHaveBeenCalled()\n      expect(developerPreview.disable).toHaveBeenCalled()\n    })\n\n    test(\"don't enable dev preview when terminal doesn't support TTY and the app doesn't supports it\", async () => {\n      vi.mocked(terminalSupportsRawMode).mockReturnValue(false)\n      const concurrentProcess = {\n        prefix: 'prefix',\n        action: vi.fn(async (_stdout, _stderr, _signal) => {}),\n      }\n\n      const processes = [concurrentProcess]\n      const previewUrl = 'https://lala.cloudflare.io/'\n      const graphiqlUrl = 'https://lala.cloudflare.io/graphiql'\n      const app = {\n        canEnablePreviewMode: false,\n        developmentStorePreviewEnabled: false,\n        apiKey: '123',\n        token: '123',\n      }\n\n      const abortController = new AbortController()\n\n      await renderDev({processes, previewUrl, graphiqlUrl, app, abortController, developerPreview})\n      abortController.abort()\n\n      expect(developerPreview.enable).not.toHaveBeenCalled()\n      expect(developerPreview.disable).not.toHaveBeenCalled()\n    })\n\n    test('uses ink when terminal supports TTY', async () => {\n      vi.mocked(terminalSupportsRawMode).mockReturnValue(true)\n      const concurrentProcess = {\n        prefix: 'prefix',\n        action: vi.fn(async (_stdout, _stderr, _signal) => {}),\n      }\n\n      const processes = [concurrentProcess]\n      const previewUrl = 'https://lala.cloudflare.io/'\n      const graphiqlUrl = 'https://lala.cloudflare.io/graphiql'\n      const app = {\n        canEnablePreviewMode: true,\n        developmentStorePreviewEnabled: false,\n        apiKey: '123',\n        token: '123',\n      }\n\n      const abortController = new AbortController()\n\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      renderDev({processes, previewUrl, graphiqlUrl, app, abortController, developerPreview})\n\n      await new Promise((resolve) => setTimeout(resolve, 100))\n\n      expect(vi.mocked(Dev)).toHaveBeenCalled()\n      expect(concurrentProcess.action).not.toHaveBeenCalled()\n    })\n  })\n})\n\nasync function mockApp(newConfig = false): Promise<AppInterface> {\n  const nodeDependencies: {[key: string]: string} = {}\n  nodeDependencies['@shopify/cli'] = '2.2.2'\n\n  const functionExtension = await testFunctionExtension()\n  const themeExtension = await testThemeExtensions()\n  const uiExtension = await testUIExtension()\n  const configurationPath = joinPath('/', newConfig ? 'shopify.app.staging.toml' : 'shopify.app.toml')\n\n  const result = testApp(\n    {\n      name: 'my-super-customer-accounts-app',\n      directory: '/',\n      nodeDependencies,\n      allExtensions: [functionExtension, themeExtension, uiExtension],\n    },\n    newConfig ? 'current' : 'legacy',\n  )\n  result.configuration.path = configurationPath\n\n  return result\n}\n"]}