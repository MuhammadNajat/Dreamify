{"version":3,"file":"previewable-extension.js","sourceRoot":"","sources":["../../../../../src/cli/services/dev/processes/previewable-extension.ts"],"names":[],"mappings":"AACA,OAAO,EAAC,eAAe,EAAC,MAAM,iBAAiB,CAAA;AAE/C,OAAO,EAAC,oBAAoB,EAAC,MAAM,2BAA2B,CAAA;AAG9D,MAAM,CAAC,MAAM,gBAAgB,GAAG,GAAG,CAAA;AAuBnC,MAAM,CAAC,MAAM,iCAAiC,GAAoD,KAAK,EACrG,EAAC,MAAM,EAAE,MAAM,EAAE,WAAW,EAAC,EAC7B,EACE,MAAM,EACN,SAAS,EACT,OAAO,EACP,sBAAsB,EACtB,IAAI,EACJ,OAAO,EACP,QAAQ,EACR,OAAO,EACP,aAAa,EACb,KAAK,EACL,aAAa,EACb,qBAAqB,EACrB,YAAY,GACb,EACD,EAAE;IACF,MAAM,eAAe,CAAC;QACpB,OAAO;QACP,aAAa;QACb,YAAY;QACZ,EAAE,EAAE,KAAK;QACT,UAAU,EAAE,qBAAqB;QACjC,MAAM;QACN,MAAM;QACN,MAAM,EAAE,WAAW;QACnB,GAAG,EAAE,QAAQ;QACb,IAAI;QACJ,SAAS;QACT,OAAO;QACP,MAAM;QACN,aAAa;QACb,eAAe,EAAE,OAAO;QACxB,sBAAsB;QACtB,eAAe,EAAE,gBAAgB;KAClC,CAAC,CAAA;AACJ,CAAC,CAAA;AAED,MAAM,CAAC,KAAK,UAAU,iCAAiC,CAAC,EACtD,aAAa,EACb,SAAS,EACT,eAAe,EACf,GAAG,OAAO,EAIX;IACC,MAAM,qBAAqB,GAAG,aAAa,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,CAAC,aAAa,CAAC,CAAA;IAC9E,IAAI,qBAAqB,CAAC,MAAM,KAAK,CAAC,EAAE;QACtC,OAAM;KACP;IAED,MAAM,OAAO,GAAG,MAAM,oBAAoB,CAAC,qBAAqB,EAAE,SAAS,EAAE,eAAe,CAAC,CAAA;IAE7F,OAAO;QACL,MAAM,EAAE,YAAY;QACpB,IAAI,EAAE,uBAAuB;QAC7B,QAAQ,EAAE,iCAAiC;QAC3C,OAAO,EAAE;YACP,UAAU,EAAE,aAAa;YACzB,IAAI,EAAE,CAAC,CAAC;YACR,SAAS;YACT,qBAAqB;YACrB,OAAO;YACP,GAAG,OAAO;SACX;KACF,CAAA;AACH,CAAC","sourcesContent":["import {BaseProcess, DevProcessFunction} from './types.js'\nimport {devUIExtensions} from '../extension.js'\nimport {ExtensionInstance} from '../../../models/extensions/extension-instance.js'\nimport {buildCartURLIfNeeded} from '../extension/utilities.js'\nimport {DotEnvFile} from '@shopify/cli-kit/node/dot-env'\n\nexport const MANIFEST_VERSION = '3'\n\nexport interface PreviewableExtensionOptions {\n  apiKey: string\n  storeFqdn: string\n  storeId: string\n  port: number\n  pathPrefix: string\n  cartUrl?: string\n  subscriptionProductUrl?: string\n  proxyUrl: string\n  appName: string\n  appDotEnvFile?: DotEnvFile\n  appDirectory: string\n  appId?: string\n  grantedScopes: string[]\n  previewableExtensions: ExtensionInstance[]\n}\n\nexport interface PreviewableExtensionProcess extends BaseProcess<PreviewableExtensionOptions> {\n  type: 'previewable-extension'\n}\n\nexport const launchPreviewableExtensionProcess: DevProcessFunction<PreviewableExtensionOptions> = async (\n  {stderr, stdout, abortSignal},\n  {\n    apiKey,\n    storeFqdn,\n    storeId,\n    subscriptionProductUrl,\n    port,\n    cartUrl,\n    proxyUrl,\n    appName,\n    appDotEnvFile,\n    appId,\n    grantedScopes,\n    previewableExtensions,\n    appDirectory,\n  },\n) => {\n  await devUIExtensions({\n    appName,\n    appDotEnvFile,\n    appDirectory,\n    id: appId,\n    extensions: previewableExtensions,\n    stdout,\n    stderr,\n    signal: abortSignal,\n    url: proxyUrl,\n    port,\n    storeFqdn,\n    storeId,\n    apiKey,\n    grantedScopes,\n    checkoutCartUrl: cartUrl,\n    subscriptionProductUrl,\n    manifestVersion: MANIFEST_VERSION,\n  })\n}\n\nexport async function setupPreviewableExtensionsProcess({\n  allExtensions,\n  storeFqdn,\n  checkoutCartUrl,\n  ...options\n}: Omit<PreviewableExtensionOptions, 'pathPrefix' | 'previewableExtensions' | 'port' | 'cartUrl'> & {\n  allExtensions: ExtensionInstance[]\n  checkoutCartUrl?: string\n}): Promise<PreviewableExtensionProcess | undefined> {\n  const previewableExtensions = allExtensions.filter((ext) => ext.isPreviewable)\n  if (previewableExtensions.length === 0) {\n    return\n  }\n\n  const cartUrl = await buildCartURLIfNeeded(previewableExtensions, storeFqdn, checkoutCartUrl)\n\n  return {\n    prefix: 'extensions',\n    type: 'previewable-extension',\n    function: launchPreviewableExtensionProcess,\n    options: {\n      pathPrefix: '/extensions',\n      port: -1,\n      storeFqdn,\n      previewableExtensions,\n      cartUrl,\n      ...options,\n    },\n  }\n}\n"]}