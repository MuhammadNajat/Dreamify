{"version":3,"file":"push.js","sourceRoot":"","sources":["../../../../src/cli/services/draft-extensions/push.ts"],"names":[],"mappings":"AAAA,OAAO,EAA6B,sBAAsB,EAAE,gCAAgC,EAAC,MAAM,eAAe,CAAA;AAClH,OAAO,EAAC,WAAW,EAAC,MAAM,sBAAsB,CAAA;AAChD,OAAO,EAAC,oBAAoB,EAAC,MAAM,4BAA4B,CAAA;AAC/D,OAAO,EAAC,UAAU,EAAC,MAAM,6BAA6B,CAAA;AACtD,OAAO,EAAC,gBAAgB,EAAC,MAAM,0BAA0B,CAAA;AAEzD,OAAO,EAAC,aAAa,EAAC,MAAM,8BAA8B,CAAA;AAG1D,MAAM,CAAC,KAAK,UAAU,mBAAmB,CAAC,0BAAsD;IAC9F,MAAM,EAAC,GAAG,EAAE,eAAe,EAAE,kBAAkB,EAAE,SAAS,EAAC,GAAG,MAAM,gCAAgC,CAClG,0BAA0B,CAC3B,CAAA;IAED,MAAM,WAAW,CAAC,GAAG,CAAC,CAAA;IAEtB,MAAM,gBAAgB,CAAC;QACrB,SAAS,EAAE,GAAG,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC,SAAS,EAAE,EAAE;YAC7C,OAAO;gBACL,MAAM,EAAE,SAAS,CAAC,eAAe;gBACjC,MAAM,EAAE,KAAK,EAAE,MAAgB,EAAE,MAAgB,EAAE,MAAmB,EAAE,EAAE;oBACxE,MAAM,SAAS,CAAC,KAAK,CAAC,EAAC,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,EAAE,WAAW,EAAE,aAAa,EAAC,CAAC,CAAA;oBAChF,MAAM,cAAc,GAAG,kBAAkB,CAAC,SAAS,CAAC,eAAe,CAAC,CAAA;oBACpE,IAAI,CAAC,cAAc,EAAE;wBACnB,MAAM,IAAI,UAAU,CAAC,aAAa,SAAS,CAAC,eAAe,2BAA2B,CAAC,CAAA;qBACxF;oBACD,MAAM,oBAAoB,CAAC;wBACzB,SAAS;wBACT,KAAK,EAAE,eAAe,CAAC,KAAK;wBAC5B,MAAM,EAAE,SAAS,CAAC,MAAM;wBACxB,cAAc;wBACd,MAAM;wBACN,MAAM;qBACP,CAAC,CAAA;gBACJ,CAAC;aACF,CAAA;QACH,CAAC,CAAC;QACF,cAAc,EAAE,KAAK;KACtB,CAAC,CAAA;IAEF,IAAI,0BAA0B,CAAC,sBAAsB,EAAE;QACrD,MAAM,sBAAsB,CAAC,EAAC,KAAK,EAAE,eAAe,CAAC,KAAK,EAAE,MAAM,EAAE,SAAS,CAAC,MAAM,EAAC,CAAC,CAAA;QACtF,aAAa,CAAC,qBAAqB,CAAC,CAAA;KACrC;AACH,CAAC","sourcesContent":["import {DraftExtensionsPushOptions, enableDeveloperPreview, ensureDraftExtensionsPushContext} from '../context.js'\nimport {installJavy} from '../function/build.js'\nimport {updateExtensionDraft} from '../dev/update-extension.js'\nimport {AbortError} from '@shopify/cli-kit/node/error'\nimport {renderConcurrent} from '@shopify/cli-kit/node/ui'\nimport {AbortSignal} from '@shopify/cli-kit/node/abort'\nimport {outputSuccess} from '@shopify/cli-kit/node/output'\nimport {Writable} from 'stream'\n\nexport async function draftExtensionsPush(draftExtensionsPushOptions: DraftExtensionsPushOptions) {\n  const {app, partnersSession, remoteExtensionIds, remoteApp} = await ensureDraftExtensionsPushContext(\n    draftExtensionsPushOptions,\n  )\n\n  await installJavy(app)\n\n  await renderConcurrent({\n    processes: app.allExtensions.map((extension) => {\n      return {\n        prefix: extension.localIdentifier,\n        action: async (stdout: Writable, stderr: Writable, signal: AbortSignal) => {\n          await extension.build({stderr, stdout, signal, app, environment: 'development'})\n          const registrationId = remoteExtensionIds[extension.localIdentifier]\n          if (!registrationId) {\n            throw new AbortError(`Extension ${extension.localIdentifier} not found on remote app.`)\n          }\n          await updateExtensionDraft({\n            extension,\n            token: partnersSession.token,\n            apiKey: remoteApp.apiKey,\n            registrationId,\n            stdout,\n            stderr,\n          })\n        },\n      }\n    }),\n    showTimestamps: false,\n  })\n\n  if (draftExtensionsPushOptions.enableDeveloperPreview) {\n    await enableDeveloperPreview({token: partnersSession.token, apiKey: remoteApp.apiKey})\n    outputSuccess(`Enabled dev preview`)\n  }\n}\n"]}