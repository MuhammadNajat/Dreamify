{"version":3,"file":"partner-account-info.js","sourceRoot":"","sources":["../../../../src/cli/services/context/partner-account-info.ts"],"names":[],"mappings":"AAAA,OAAO,EAAC,oBAAoB,EAAC,MAAM,2CAA2C,CAAA;AAC9E,OAAO,EAAC,WAAW,EAAC,MAAM,8BAA8B,CAAA;AACxD,OAAO,EAAC,2BAA2B,EAAC,MAAM,+BAA+B,CAAA;AAuBzE,MAAM,UAAU,aAAa,CAAC,OAAoB;IAChD,OAAO,OAAO,CAAC,IAAI,KAAK,aAAa,CAAA;AACvC,CAAC;AAED,MAAM,UAAU,gBAAgB,CAAC,OAAoB;IACnD,OAAO,OAAO,CAAC,IAAI,KAAK,gBAAgB,CAAA;AAC1C,CAAC;AAED,MAAM,UAAU,gBAAgB,CAAC,OAAoB;IACnD,OAAO,OAAO,CAAC,IAAI,KAAK,gBAAgB,CAAA;AAC1C,CAAC;AAED,MAAM,CAAC,KAAK,UAAU,oBAAoB;IACxC,MAAM,KAAK,GAAG,MAAM,2BAA2B,EAAE,CAAA;IACjD,OAAO;QACL,KAAK;QACL,WAAW,EAAE,MAAM,8BAA8B,CAAC,KAAK,CAAC;KACzD,CAAA;AACH,CAAC;AAED,KAAK,UAAU,8BAA8B,CAAC,KAAa;IACzD,IAAI;QACF,OAAO,MAAM,oBAAoB,CAAC,KAAK,CAAC,CAAA;QACxC,qDAAqD;KACtD;IAAC,OAAO,KAAK,EAAE;QACd,WAAW,CAAC,kCAAkC,CAAC,CAAA;QAC/C,OAAO,EAAC,IAAI,EAAE,gBAAgB,EAAC,CAAA;KAChC;AACH,CAAC","sourcesContent":["import {geCurrentAccountInfo} from '../../api/graphql/current_account_info.js'\nimport {outputDebug} from '@shopify/cli-kit/node/output'\nimport {ensureAuthenticatedPartners} from '@shopify/cli-kit/node/session'\n\nexport interface PartnersSession {\n  token: string\n  accountInfo: AccountInfo\n}\n\nexport type AccountInfo = UserAccountInfo | ServiceAccountInfo | UnknownAccountInfo\n\ninterface UserAccountInfo {\n  type: 'UserAccount'\n  email: string\n}\n\ninterface ServiceAccountInfo {\n  type: 'ServiceAccount'\n  orgName: string\n}\n\ninterface UnknownAccountInfo {\n  type: 'UnknownAccount'\n}\n\nexport function isUserAccount(account: AccountInfo): account is UserAccountInfo {\n  return account.type === 'UserAccount'\n}\n\nexport function isServiceAccount(account: AccountInfo): account is ServiceAccountInfo {\n  return account.type === 'ServiceAccount'\n}\n\nexport function isUnknownAccount(account: AccountInfo): account is UnknownAccountInfo {\n  return account.type === 'UnknownAccount'\n}\n\nexport async function fetchPartnersSession(): Promise<PartnersSession> {\n  const token = await ensureAuthenticatedPartners()\n  return {\n    token,\n    accountInfo: await fetchCurrentAccountInformation(token),\n  }\n}\n\nasync function fetchCurrentAccountInformation(token: string): Promise<AccountInfo> {\n  try {\n    return await geCurrentAccountInfo(token)\n    // eslint-disable-next-line no-catch-all/no-catch-all\n  } catch (error) {\n    outputDebug('Error fetching user account info')\n    return {type: 'UnknownAccount'}\n  }\n}\n"]}