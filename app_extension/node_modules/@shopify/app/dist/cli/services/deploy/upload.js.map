{"version":3,"file":"upload.js","sourceRoot":"","sources":["../../../../src/cli/services/deploy/upload.ts"],"names":[],"mappings":"AAAA,OAAO,EAAC,oBAAoB,IAAI,4BAA4B,EAAC,MAAM,6BAA6B,CAAA;AAEhG,OAAO,EACL,yBAAyB,GAE1B,MAAM,oDAAoD,CAAA;AAC3D,OAAO,EAEL,4BAA4B,GAE7B,MAAM,mCAAmC,CAAA;AAC1C,OAAO,EAAC,SAAS,EAAyD,MAAM,iCAAiC,CAAA;AACjH,OAAO,EACL,uBAAuB,GAGxB,MAAM,iDAAiD,CAAA;AACxD,OAAO,EACL,sBAAsB,GAGvB,MAAM,iDAAiD,CAAA;AAGxD,OAAO,EAAC,oBAAoB,EAAE,eAAe,EAAC,MAAM,oCAAoC,CAAA;AACxF,OAAO,EAAC,2BAA2B,EAAC,MAAM,+BAA+B,CAAA;AACzE,OAAO,EAAC,UAAU,EAAE,QAAQ,EAAE,YAAY,EAAC,MAAM,0BAA0B,CAAA;AAC3E,OAAO,EAAC,KAAK,EAAE,QAAQ,EAAC,MAAM,4BAA4B,CAAA;AAC1D,OAAO,EAAC,UAAU,EAAE,QAAQ,EAAC,MAAM,6BAA6B,CAAA;AAChE,OAAO,EAAC,2BAA2B,EAAE,aAAa,EAAE,WAAW,EAAC,MAAM,8BAA8B,CAAA;AAEpG,OAAO,EAAC,SAAS,EAAC,MAAM,oCAAoC,CAAA;AAC5D,OAAO,EAAC,iBAAiB,EAAC,MAAM,4CAA4C,CAAA;AAC5E,OAAO,EAAC,GAAG,EAAC,MAAM,4BAA4B,CAAA;AAa9C;;;GAGG;AACH,MAAM,CAAC,KAAK,UAAU,qBAAqB,CACzC,eAAoC,EACpC,OAAoC;IAEpC,MAAM,EAAC,MAAM,EAAE,WAAW,EAAE,KAAK,EAAC,GAAG,OAAO,CAAA;IAC5C,MAAM,OAAO,CAAC,GAAG,CACf,eAAe,CAAC,GAAG,CAAC,KAAK,EAAE,cAAc,EAAE,EAAE;QAC3C,MAAM,oBAAoB,GAAG,MAAM,4BAA4B,CAAC,cAAc,CAAC,CAAA;QAC/E,MAAM,OAAO,GAAG,WAAW,CAAC,YAAY,CAAC,cAAc,CAAC,eAAe,CAAE,CAAA;QACzE,MAAM,mBAAmB,GAA8B;YACrD,MAAM;YACN,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC,oBAAoB,CAAC;YAC5C,OAAO,EAAE,SAAS;YAClB,cAAc,EAAE,OAAO;YACvB,MAAM,EAAE,cAAc,CAAC,MAAM;SAC9B,CAAA;QACD,MAAM,QAAQ,GAAG,4BAA4B,CAAA;QAC7C,MAAM,MAAM,GAA0B,MAAM,eAAe,CAAC,QAAQ,EAAE,KAAK,EAAE,mBAAmB,CAAC,CAAA;QACjG,IAAI,MAAM,CAAC,oBAAoB,EAAE,UAAU,EAAE,MAAM,GAAG,CAAC,EAAE;YACvD,MAAM,MAAM,GAAG,MAAM,CAAC,oBAAoB,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;YAC9F,MAAM,IAAI,UAAU,CAAC,MAAM,CAAC,CAAA;SAC7B;IACH,CAAC,CAAC,CACH,CAAA;AACH,CAAC;AAoDD;;;GAGG;AACH,MAAM,CAAC,KAAK,UAAU,sBAAsB,CAC1C,OAAsC;IAEtC,IAAI,SAAS,CAAA;IACb,IAAI,WAAW,CAAA;IAEf,IAAI,OAAO,CAAC,UAAU,EAAE;QACtB,SAAS,GAAG,MAAM,qBAAqB,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA;QAEvD,MAAM,IAAI,GAAG,QAAQ,EAAE,CAAA;QACvB,MAAM,MAAM,GAAG,YAAY,CAAC,OAAO,CAAC,UAAU,CAAC,CAAA;QAC/C,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,MAAM,CAAC,CAAA;QAChC,MAAM,KAAK,CAAC,SAAS,EAAE;YACrB,MAAM,EAAE,KAAK;YACb,IAAI,EAAE,MAAM;YACZ,OAAO,EAAE,IAAI,CAAC,UAAU,EAAE;SAC3B,CAAC,CAAA;KACH;IAED,MAAM,SAAS,GAAuB;QACpC,MAAM,EAAE,OAAO,CAAC,MAAM;QACtB,WAAW,EAAE,CAAC,OAAO,CAAC,OAAO;QAC7B,OAAO,EAAE,OAAO,CAAC,OAAO;QACxB,UAAU,EAAE,OAAO,CAAC,OAAO;QAC3B,eAAe,EAAE,OAAO,CAAC,eAAe;KACzC,CAAA;IAED,IAAI,SAAS,EAAE;QACb,SAAS,CAAC,SAAS,GAAG,SAAS,CAAA;KAChC;IAED,IAAI,OAAO,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE;QACjC,SAAS,CAAC,UAAU,GAAG,OAAO,CAAC,UAAU,CAAA;KAC1C;IAED,MAAM,QAAQ,GAAG,SAAS,CAAA;IAC1B,MAAM,MAAM,GAAoB,MAAM,oBAAoB,CAAC,GAAG,EAAE,CAAC,eAAe,CAAC,QAAQ,EAAE,OAAO,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC,CAAA;IAErH,IAAI,MAAM,CAAC,SAAS,EAAE,UAAU,EAAE,MAAM,GAAG,CAAC,EAAE;QAC5C,MAAM,cAAc,GAAyB,gCAAgC,CAC3E,MAAM,CAAC,SAAS,CAAC,UAAU,EAC3B,OAAO,CAAC,YAAY,EACpB;YACE,OAAO,EAAE,OAAO,CAAC,OAAO;SACzB,CACF,CAAA;QAED,IAAI,MAAM,CAAC,SAAS,CAAC,UAAU,EAAE;YAC/B,WAAW,GAAG,MAAM,CAAC,SAAS,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;SACnF;aAAM;YACL,MAAM,IAAI,UAAU,CAAC,EAAC,IAAI,EAAE,8BAA8B,EAAC,EAAE,IAAI,EAAE,EAAE,EAAE,cAAc,CAAC,CAAA;SACvF;KACF;IAED,MAAM,gBAAgB,GAAG,MAAM,CAAC,SAAS,CAAC,UAAU,CAAC,iBAAiB;SACnE,MAAM,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,CAAC,gBAAgB,CAAC,MAAM,GAAG,CAAC,CAAC;SAChD,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE;QACX,OAAO,EAAC,IAAI,EAAE,GAAG,CAAC,gBAAgB,EAAE,MAAM,EAAE,GAAG,CAAC,gBAAgB,EAAC,CAAA;IACnE,CAAC,CAAC,CAAA;IAEJ,OAAO;QACL,gBAAgB;QAChB,UAAU,EAAE,MAAM,CAAC,SAAS,CAAC,UAAU,CAAC,UAAU;QAClD,QAAQ,EAAE,MAAM,CAAC,SAAS,CAAC,UAAU,CAAC,QAAQ;QAC9C,OAAO,EAAE,MAAM,CAAC,SAAS,CAAC,UAAU,CAAC,OAAO;QAC5C,WAAW;KACZ,CAAA;AACH,CAAC;AAED,MAAM,uBAAuB,GAAG,qBAAqB,CAAA;AACrD,MAAM,oBAAoB,GAAG,IAAI,CAAA;AAEjC,MAAM,UAAU,gCAAgC,CAC9C,MAAkD,EAClD,YAAmC,EACnC,QAEI,EAAE;IAEN,MAAM,gBAAgB,GAAG,CAAC,KAAyB,EAAE,EAAE;QACrD,OAAO,KAAK,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC,MAAM,EAAE,EAAE,CAAC,MAAM,CAAC,YAAY,CAAC,IAAI,KAAK,CAAA;IACtE,CAAC,CAAA;IAED,MAAM,UAAU,GAAG,CAAC,KAAyB,EAAE,YAAmC,EAAE,EAAE;QACpF,MAAM,gBAAgB,GACpB,KAAK,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC,MAAM,EAAE,EAAE,CAAC,OAAO,MAAM,CAAC,YAAY,KAAK,WAAW,CAAC,EAAE,YAAY,CAAC,QAAQ,EAAE,IAAI,EAAE,CAAA;QAE5G,OAAO,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,QAAQ,CAAC,gBAAgB,CAAC,CAAA;IAC/D,CAAC,CAAA;IAED,MAAM,CAAC,eAAe,EAAE,kBAAkB,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,KAAK,EAAE,EAAE,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC,CAAA;IAEnG,MAAM,CAAC,SAAS,EAAE,cAAc,CAAC,GAAG,SAAS,CAAC,eAAe,EAAE,CAAC,KAAK,EAAE,EAAE,CAAC,UAAU,CAAC,KAAK,EAAE,YAAY,CAAC,CAAC,CAAA;IAE1G,MAAM,cAAc,GAAG;QACrB,GAAG,oBAAoB,CAAC,kBAAkB,EAAE,EAAC,OAAO,EAAE,KAAK,CAAC,OAAO,EAAC,CAAC;QACrE,GAAG,iBAAiB,CAAC,SAAS,EAAE,YAAY,CAAC;QAC7C,GAAG,sBAAsB,CAAC,cAAc,CAAC;KAC1C,CAAA;IACD,OAAO,cAAc,CAAA;AACvB,CAAC;AAED,SAAS,oBAAoB,CAAC,MAAkD,EAAE,QAA4B,EAAE;IAC9G,IAAI,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE;QACrB,IACE,MAAM,CAAC,MAAM,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC,IAAI,KAAK,CAAC,OAAO,KAAK,wBAAwB,CAAC;aACxG,MAAM,GAAG,CAAC;YACb,KAAK,CAAC,OAAO,EACb;YACA,OAAO;gBACL;oBACE,IAAI,EAAE;wBACJ,8BAA8B;wBAC9B,EAAC,SAAS,EAAE,KAAK,CAAC,OAAO,EAAC;wBAC1B,6DAA6D;qBAC9D;iBACF;aACF,CAAA;SACF;QAED,IAAI,MAAM,CAAC,MAAM,KAAK,CAAC,EAAE;YACvB,OAAO;gBACL;oBACE,IAAI,EAAE,MAAM,CAAC,CAAC,CAAE,CAAC,OAAO;iBACzB;aACF,CAAA;SACF;QAED,OAAO;YACL;gBACE,IAAI,EAAE;oBACJ,IAAI,EAAE;wBACJ,KAAK,EAAE,MAAM,CAAC,GAAG,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,OAAO,CAAC;qBAC5C;iBACF;aACF;SACF,CAAA;KACF;SAAM;QACL,OAAO,EAAE,CAAA;KACV;AACH,CAAC;AAED,SAAS,iBAAiB,CAAC,MAAkD,EAAE,WAAkC;IAC/G,OAAO,MAAM,CAAC,MAAM,CAAC,CAAC,QAAQ,EAAE,KAAK,EAAE,EAAE;QACvC,MAAM,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,kBAAkB,EAAE,sBAAsB,CAAC,CAAA;QACvF,MAAM,YAAY,GAAG,KAAK,KAAK,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,KAAK,KAAK,KAAK,CAAC,OAAO,EAAE,CAAA;QAEpF,MAAM,WAAW,GAAG,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,MAAM,EAAE,EAAE,CAAC,OAAO,MAAM,CAAC,eAAe,KAAK,WAAW,CAAC,EAAE,eAAe,CAAA;QAClH,MAAM,mBAAmB,GAAG,KAAK,CAAC,OAAO;aACtC,IAAI,CAAC,CAAC,MAAM,EAAE,EAAE,CAAC,OAAO,MAAM,CAAC,YAAY,KAAK,WAAW,CAAC;YAC7D,EAAE,YAAY,CAAC,QAAQ,EAAE,CAAA;QAE3B,MAAM,MAAM,GAAG,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,WAAW,CAAC,GAAG,CAAC,KAAK,mBAAmB,CAAC,CAAA;QAC/F,MAAM,aAAa,GAAG,MAAM,IAAI,WAAW,CAAA;QAE3C,MAAM,eAAe,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,OAAO,CAAC,KAAK,KAAK,aAAa,CAAC,CAAA;QAEnF,IAAI,eAAe,EAAE;YACnB,MAAM,WAAW,GAAG,eAAe,CAAC,IAAmB,CAAA;YACvD,MAAM,UAAU,GACd,KAAK,CAAC,QAAQ,KAAK,SAAS;gBAC1B,CAAC,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,SAAS,EAAE,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,KAAK,uBAAuB,CAAC;gBACnF,CAAC,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,SAAS,EAAE,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,KAAK,oBAAoB,CAAC,CAAA;YAEpF,IAAI,UAAU,EAAE;gBACd,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,YAAY,CAAC,CAAA;aACzC;iBAAM;gBACL,WAAW,CAAC,IAAI,CAAC;oBACf,IAAI,EAAE;wBACJ,KAAK,EAAE,KAAK,CAAC,QAAQ,KAAK,SAAS,CAAC,CAAC,CAAC,uBAAuB,CAAC,CAAC,CAAC,oBAAoB;wBACpF,KAAK,EAAE,CAAC,YAAY,CAAC;qBACtB;iBACF,CAAC,CAAA;aACH;SACF;aAAM;YACL,QAAQ,CAAC,IAAI,CAAC;gBACZ,KAAK,EAAE,aAAa;gBACpB,IAAI,EAAE;oBACJ;wBACE,IAAI,EAAE;4BACJ,KAAK,EAAE,KAAK,CAAC,QAAQ,KAAK,SAAS,CAAC,CAAC,CAAC,uBAAuB,CAAC,CAAC,CAAC,oBAAoB;4BACpF,KAAK,EAAE,CAAC,YAAY,CAAC;yBACtB;qBACF;iBACF;aACF,CAAC,CAAA;SACH;QAED,QAAQ,CAAC,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE;YAC3B,qCAAqC;YACrC,CAAC;YAAC,OAAO,CAAC,IAAoB,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE;gBAC3C,IAAI,CAAC,CAAC,IAAI,CAAC,KAAK,KAAK,uBAAuB,EAAE;oBAC5C,OAAO,CAAC,CAAA;iBACT;gBAED,IAAI,CAAC,CAAC,IAAI,CAAC,KAAK,KAAK,uBAAuB,EAAE;oBAC5C,OAAO,CAAC,CAAC,CAAA;iBACV;gBAED,OAAO,CAAC,CAAA;YACV,CAAC,CAAC,CAAA;QACJ,CAAC,CAAC,CAAA;QAEF,OAAO,QAAQ,CAAA;IACjB,CAAC,EAAE,EAA0B,CAAC,CAAA;AAChC,CAAC;AAED,SAAS,sBAAsB,CAAC,MAAkD;IAChF,OAAO,MAAM;SACV,MAAM,CAAC,CAAC,QAAQ,EAAE,KAAK,EAAE,EAAE;QAC1B,MAAM,mBAAmB,GAAG,KAAK,CAAC,OAAO,CAAC,IAAI,CAC5C,CAAC,MAAM,EAAE,EAAE,CAAC,OAAO,MAAM,CAAC,eAAe,KAAK,WAAW,CAC1D,EAAE,eAAe,CAAA;QAElB,MAAM,eAAe,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,OAAO,CAAC,KAAK,KAAK,mBAAmB,CAAC,CAAA;QAEzF,IAAI,eAAe,EAAE;YACnB,eAAe,CAAC,UAAU,IAAI,CAAC,CAAA;SAChC;aAAM;YACL,QAAQ,CAAC,IAAI,CAAC;gBACZ,KAAK,EAAE,mBAAmB;gBAC1B,UAAU,EAAE,CAAC;aACd,CAAC,CAAA;SACH;QAED,OAAO,QAAQ,CAAA;IACjB,CAAC,EAAE,EAAuD,CAAC;SAC1D,GAAG,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC;QACjB,KAAK,EAAE,OAAO,CAAC,KAAK;QACpB,IAAI,EAAE,KAAK,OAAO,CAAC,UAAU,SAC3B,OAAO,CAAC,UAAU,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EACjC,8FAA8F;KAC/F,CAAC,CAAyB,CAAA;AAC/B,CAAC;AAED;;;GAGG;AACH,MAAM,CAAC,KAAK,UAAU,qBAAqB,CAAC,MAAc;IACxD,MAAM,QAAQ,GAAG,uBAAuB,CAAA;IACxC,MAAM,KAAK,GAAG,MAAM,2BAA2B,EAAE,CAAA;IACjD,MAAM,SAAS,GAAqC;QAClD,MAAM;QACN,YAAY,EAAE,CAAC;KAChB,CAAA;IAED,MAAM,MAAM,GAAkC,MAAM,oBAAoB,CAAC,GAAG,EAAE,CAC5E,eAAe,CAAC,QAAQ,EAAE,KAAK,EAAE,SAAS,CAAC,CAC5C,CAAA;IAED,IAAI,MAAM,CAAC,iCAAiC,EAAE,UAAU,EAAE,MAAM,GAAG,CAAC,EAAE;QACpE,MAAM,MAAM,GAAG,MAAM,CAAC,iCAAiC,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;QAC3G,MAAM,IAAI,UAAU,CAAC,MAAM,CAAC,CAAA;KAC7B;IAED,OAAO,MAAM,CAAC,iCAAiC,CAAC,eAAe,CAAA;AACjE,CAAC;AAUD;;;;;;;;;;GAUG;AACH,MAAM,CAAC,KAAK,UAAU,wBAAwB,CAC5C,UAAmD,EACnD,OAAwC;IAExC,IAAI,WAAW,GAAG,OAAO,CAAC,WAAW,CAAA;IAErC,MAAM,WAAW,GAA0B,EAAE,CAAA;IAE7C,sEAAsE;IACtE,KAAK,MAAM,SAAS,IAAI,UAAU,EAAE;QAClC,4CAA4C;QAC5C,MAAM,gBAAgB,GAAG,MAAM,uBAAuB,CAAC,SAAS,EAAE;YAChE,MAAM,EAAE,OAAO,CAAC,WAAW,CAAC,GAAG;YAC/B,KAAK,EAAE,OAAO,CAAC,KAAK;YACpB,UAAU,EAAE,WAAW,CAAC,UAAU,CAAC,SAAS,CAAC,eAAe,CAAC;SAC9D,CAAC,CAAA;QACF,WAAW,CAAC,SAAS,CAAC,eAAe,CAAC,GAAG,gBAAgB,CAAA;KAC1D;IAED,WAAW,GAAG;QACZ,GAAG,WAAW;QACd,UAAU,EAAE;YACV,GAAG,WAAW,CAAC,UAAU;YACzB,GAAG,WAAW;SACf;KACF,CAAA;IAED,OAAO,WAAW,CAAA;AACpB,CAAC;AAQD,KAAK,UAAU,uBAAuB,CACpC,SAAgD,EAChD,OAAuC;IAEvC,MAAM,EAAC,GAAG,EAAC,GAAG,MAAM,cAAc,CAAC,SAAS,CAAC,eAAe,EAAE,SAAS,CAAC,UAAU,EAAE,OAAO,CAAC,MAAM,EAAE,OAAO,CAAC,KAAK,CAAC,CAAA;IAElH,IAAI,UAA8B,CAAA;IAClC,IAAI,MAAM,UAAU,CAAC,SAAS,CAAC,cAAc,CAAC,EAAE;QAC9C,UAAU,GAAG,MAAM,QAAQ,CAAC,SAAS,CAAC,cAAc,CAAC,CAAA;KACtD;IAED,MAAM,KAAK,GAAG,sBAAsB,CAAA;IACpC,MAAM,SAAS,GAA4B;QACzC,+FAA+F;QAC/F,GAAG,CAAC,OAAO,CAAC,UAAU,EAAE,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAC,UAAU,EAAE,OAAO,CAAC,UAAU,EAAC,CAAC,CAAC,CAAC,EAAC,EAAE,EAAE,OAAO,CAAC,UAAU,EAAC,CAAC;QACpG,KAAK,EAAE,SAAS,CAAC,aAAa,CAAC,IAAI;QACnC,WAAW,EAAE,SAAS,CAAC,aAAa,CAAC,WAAW,IAAI,EAAE;QACtD,OAAO,EAAE,SAAS,CAAC,aAAa,CAAC,IAAI;QACrC,UAAU,EAAE,SAAS,CAAC,aAAa,CAAC,WAAW;QAC/C,UAAU;QACV,mBAAmB,EAAE,SAAS,CAAC,aAAa,CAAC,KAAK,EAAE,SAAS;YAC3D,CAAC,CAAC;gBACE,mBAAmB,EAAE,SAAS,CAAC,aAAa,CAAC,KAAK,CAAC,SAAS;aAC7D;YACH,CAAC,CAAC,SAAS;QACb,SAAS,EAAE,SAAS,CAAC,aAAa,CAAC,EAAE,EAAE,KAAK;YAC1C,CAAC,CAAC;gBACE,WAAW,EAAE,SAAS,CAAC,aAAa,CAAC,EAAE,CAAC,KAAK,CAAC,OAAO;gBACrD,UAAU,EAAE,SAAS,CAAC,aAAa,CAAC,EAAE,CAAC,KAAK,CAAC,MAAM;aACpD;YACH,CAAC,CAAC,SAAS;QACb,gBAAgB,EAAE,SAAS,CAAC,aAAa,CAAC,EAAE,EAAE,aAAa,IAAI,IAAI;QACnE,eAAe,EAAE,GAAG;KACrB,CAAA;IAED,MAAM,GAAG,GAAiC,MAAM,oBAAoB,CAAC,OAAO,CAAC,MAAM,EAAE,KAAK,EAAE,OAAO,CAAC,KAAK,EAAE,SAAS,CAAC,CAAA;IACrH,MAAM,UAAU,GAAG,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC,UAAU,IAAI,EAAE,CAAA;IACxD,IAAI,UAAU,CAAC,MAAM,KAAK,CAAC,EAAE;QAC3B,IAAI,UAAU,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,GAAG,KAAK,2BAA2B,CAAC,EAAE;YACzE,MAAM,YAAY,GAAG,aAAa,CAAA,kDAAkD,CAAA;YACpF,MAAM,UAAU,GAAc;gBAC5B,OAAO,EAAE,oDAAoD,SAAS,CAAC,OAAO,8CAA8C,SAAS,CAAC,UAAU,IAAI;aACrJ,CAAA;YACD,MAAM,cAAc,GAAyB;gBAC3C;oBACE,IAAI,EAAE;wBACJ,IAAI,EAAE;4BACJ,KAAK,EAAE,WAAW;4BAClB,KAAK,EAAE;gCACL;oCACE,IAAI,EAAE;wCACJ,KAAK,EAAE,gBAAgB;wCACvB,GAAG,EAAE,+CAA+C;qCACrD;iCACF;6BACF;yBACF;qBACF;iBACF;aACF,CAAA;YACD,MAAM,IAAI,UAAU,CAAC,YAAY,EAAE,UAAU,EAAE,EAAE,EAAE,cAAc,CAAC,CAAA;SACnE;aAAM;YACL,MAAM,YAAY,GAAG,aAAa,CAAA,gEAAgE,WAAW,CAAC,IAAI,CAChH,UAAU,CACX,EAAE,CAAA;YACH,MAAM,IAAI,UAAU,CAAC,YAAY,CAAC,CAAA;SACnC;KACF;IACD,OAAO,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC,QAAQ,EAAE,EAAY,CAAA;AACpD,CAAC;AAED,MAAM,CAAC,KAAK,UAAU,cAAc,CAClC,mBAA2B,EAC3B,QAAgB,EAChB,MAAc,EACd,KAAa;IAEb,MAAM,EAAC,GAAG,EAAE,QAAQ,EAAE,OAAO,EAAE,OAAO,EAAC,GAAG,MAAM,6BAA6B,CAAC,EAAC,MAAM,EAAE,KAAK,EAAC,CAAC,CAAA;IAC9F,OAAO,CAAC,cAAc,CAAC,GAAG,kBAAkB,CAAA;IAE5C,MAAM,eAAe,GAAG,MAAM,QAAQ,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAA;IACpD,MAAM,GAAG,GAAG,MAAM,KAAK,CAAC,GAAG,EAAE,EAAC,IAAI,EAAE,eAAe,EAAE,OAAO,EAAE,MAAM,EAAE,KAAK,EAAC,CAAC,CAAA;IAC7E,MAAM,OAAO,GAAG,GAAG,CAAC,IAAI,EAAE,IAAI,EAAE,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAA;IAElD,IAAI,GAAG,CAAC,MAAM,KAAK,GAAG,EAAE;QACtB,OAAO,EAAC,GAAG,EAAE,QAAQ,EAAC,CAAA;KACvB;SAAM,IAAI,GAAG,CAAC,MAAM,KAAK,GAAG,IAAI,OAAO,CAAC,QAAQ,CAAC,gBAAgB,CAAC,EAAE;QACnE,MAAM,YAAY,GAAG,aAAa,CAAA,iDAAiD,mBAAmB,uCAAuC,OAAO,GAAG,CAAA;QACvJ,MAAM,IAAI,UAAU,CAAC,YAAY,CAAC,CAAA;KACnC;SAAM,IAAI,GAAG,CAAC,MAAM,IAAI,GAAG,IAAI,GAAG,CAAC,MAAM,GAAG,GAAG,EAAE;QAChD,MAAM,YAAY,GAAG,aAAa,CAAA,+CAA+C,mBAAmB,sCAAsC,GAAG,CAAC,MAAM,CAAC,QAAQ,EAAE,cAAc,OAAO,EAAE,CAAA;QACtL,MAAM,IAAI,QAAQ,CAAC,YAAY,CAAC,CAAA;KACjC;SAAM;QACL,MAAM,YAAY,GAAG,aAAa,CAAA,+CAA+C,mBAAmB,cAAc,CAAA;QAClH,MAAM,IAAI,UAAU,CAAC,YAAY,CAAC,CAAA;KACnC;AACH,CAAC;AAcD,KAAK,UAAU,6BAA6B,CAC1C,OAA6C;IAE7C,MAAM,GAAG,GAAoC,MAAM,oBAAoB,CAAC,GAAG,EAAE,CAC3E,oBAAoB,CAAC,OAAO,CAAC,MAAM,EAAE,yBAAyB,EAAE,OAAO,CAAC,KAAK,CAAC,CAC/E,CAAA;IACD,OAAO,GAAG,CAAC,IAAI,CAAC,iBAAiB,CAAA;AACnC,CAAC;AAED,KAAK,UAAU,oBAAoB,CAAI,OAAyB;IAC9D,IAAI;QACF,MAAM,MAAM,GAAG,MAAM,OAAO,EAAE,CAAA;QAC9B,OAAO,MAAM,CAAA;QACb,8DAA8D;KAC/D;IAAC,OAAO,KAAU,EAAE;QACnB,IAAI,KAAK,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,EAAE,UAAU,EAAE,IAAI,KAAK,4BAA4B,EAAE;YACxE,MAAM,cAAc,GAAG,MAAM,iBAAiB,CAAC,GAAG,EAAE,CAAC,CAAA;YAErD,MAAM,IAAI,UAAU,CAAC,CAAC,qCAAqC,EAAE,EAAC,OAAO,EAAE,QAAQ,EAAC,EAAE,UAAU,CAAC,EAAE,IAAI,EAAE;gBACnG,CAAC,KAAK,EAAE,EAAC,OAAO,EAAE,2BAA2B,CAAC,cAAc,EAAE,iBAAiB,CAAC,EAAC,CAAC;aACnF,CAAC,CAAA;SACH;QAED,MAAM,KAAK,CAAA;KACZ;AACH,CAAC","sourcesContent":["import {themeExtensionConfig as generateThemeExtensionConfig} from './theme-extension-config.js'\nimport {Identifiers, IdentifiersExtensions} from '../../models/app/identifiers.js'\nimport {\n  UploadUrlGenerateMutation,\n  UploadUrlGenerateMutationSchema,\n} from '../../api/graphql/functions/upload_url_generate.js'\nimport {\n  ExtensionUpdateDraftInput,\n  ExtensionUpdateDraftMutation,\n  ExtensionUpdateSchema,\n} from '../../api/graphql/update_draft.js'\nimport {AppDeploy, AppDeploySchema, AppDeployVariables, AppModuleSettings} from '../../api/graphql/app_deploy.js'\nimport {\n  GenerateSignedUploadUrl,\n  GenerateSignedUploadUrlSchema,\n  GenerateSignedUploadUrlVariables,\n} from '../../api/graphql/generate_signed_upload_url.js'\nimport {\n  AppFunctionSetMutation,\n  AppFunctionSetMutationSchema,\n  AppFunctionSetVariables,\n} from '../../api/graphql/functions/app_function_set.js'\nimport {ExtensionInstance} from '../../models/extensions/extension-instance.js'\nimport {FunctionConfigType} from '../../models/extensions/specifications/function.js'\nimport {functionProxyRequest, partnersRequest} from '@shopify/cli-kit/node/api/partners'\nimport {ensureAuthenticatedPartners} from '@shopify/cli-kit/node/session'\nimport {fileExists, readFile, readFileSync} from '@shopify/cli-kit/node/fs'\nimport {fetch, formData} from '@shopify/cli-kit/node/http'\nimport {AbortError, BugError} from '@shopify/cli-kit/node/error'\nimport {formatPackageManagerCommand, outputContent, outputToken} from '@shopify/cli-kit/node/output'\nimport {AlertCustomSection, ListToken, TokenItem} from '@shopify/cli-kit/node/ui'\nimport {partition} from '@shopify/cli-kit/common/collection'\nimport {getPackageManager} from '@shopify/cli-kit/node/node-package-manager'\nimport {cwd} from '@shopify/cli-kit/node/path'\n\ninterface DeployThemeExtensionOptions {\n  /** The application API key */\n  apiKey: string\n\n  /** Set of local identifiers */\n  identifiers: Identifiers\n\n  /** The token to send authenticated requests to the partners' API  */\n  token: string\n}\n\n/**\n * Uploads theme extension(s)\n * @param options - The upload options\n */\nexport async function uploadThemeExtensions(\n  themeExtensions: ExtensionInstance[],\n  options: DeployThemeExtensionOptions,\n): Promise<void> {\n  const {apiKey, identifiers, token} = options\n  await Promise.all(\n    themeExtensions.map(async (themeExtension) => {\n      const themeExtensionConfig = await generateThemeExtensionConfig(themeExtension)\n      const themeId = identifiers.extensionIds[themeExtension.localIdentifier]!\n      const themeExtensionInput: ExtensionUpdateDraftInput = {\n        apiKey,\n        config: JSON.stringify(themeExtensionConfig),\n        context: undefined,\n        registrationId: themeId,\n        handle: themeExtension.handle,\n      }\n      const mutation = ExtensionUpdateDraftMutation\n      const result: ExtensionUpdateSchema = await partnersRequest(mutation, token, themeExtensionInput)\n      if (result.extensionUpdateDraft?.userErrors?.length > 0) {\n        const errors = result.extensionUpdateDraft.userErrors.map((error) => error.message).join(', ')\n        throw new AbortError(errors)\n      }\n    }),\n  )\n}\n\ninterface UploadExtensionsBundleOptions {\n  /** The application API key */\n  apiKey: string\n\n  /** The path to the bundle file to be uploaded */\n  bundlePath?: string\n\n  /** The token to send authenticated requests to the partners' API  */\n  token: string\n\n  /** App Modules extra data */\n  appModules: AppModuleSettings[]\n\n  /** The extensions' numeric identifiers (expressed as a string). */\n  extensionIds: IdentifiersExtensions\n\n  /** Wether or not to release the version */\n  release: boolean\n\n  /** App version message */\n  message?: string\n\n  /** App version identifier */\n  version?: string\n\n  /** The git reference url of the app version */\n  commitReference?: string\n}\n\nexport interface UploadExtensionValidationError {\n  uuid: string\n  errors: {\n    message: string\n    field: string[]\n  }[]\n}\n\nexport interface UploadExtensionsBundleOutput {\n  validationErrors: UploadExtensionValidationError[]\n  versionTag: string\n  message?: string\n  location: string\n  deployError?: string\n}\n\ntype ErrorSectionBody = TokenItem\ninterface ErrorCustomSection extends AlertCustomSection {\n  body: ErrorSectionBody\n}\n\n/**\n * Uploads a bundle.\n * @param options - The upload options\n */\nexport async function uploadExtensionsBundle(\n  options: UploadExtensionsBundleOptions,\n): Promise<UploadExtensionsBundleOutput> {\n  let signedURL\n  let deployError\n\n  if (options.bundlePath) {\n    signedURL = await getExtensionUploadURL(options.apiKey)\n\n    const form = formData()\n    const buffer = readFileSync(options.bundlePath)\n    form.append('my_upload', buffer)\n    await fetch(signedURL, {\n      method: 'put',\n      body: buffer,\n      headers: form.getHeaders(),\n    })\n  }\n\n  const variables: AppDeployVariables = {\n    apiKey: options.apiKey,\n    skipPublish: !options.release,\n    message: options.message,\n    versionTag: options.version,\n    commitReference: options.commitReference,\n  }\n\n  if (signedURL) {\n    variables.bundleUrl = signedURL\n  }\n\n  if (options.appModules.length > 0) {\n    variables.appModules = options.appModules\n  }\n\n  const mutation = AppDeploy\n  const result: AppDeploySchema = await handlePartnersErrors(() => partnersRequest(mutation, options.token, variables))\n\n  if (result.appDeploy?.userErrors?.length > 0) {\n    const customSections: AlertCustomSection[] = deploymentErrorsToCustomSections(\n      result.appDeploy.userErrors,\n      options.extensionIds,\n      {\n        version: options.version,\n      },\n    )\n\n    if (result.appDeploy.appVersion) {\n      deployError = result.appDeploy.userErrors.map((error) => error.message).join(', ')\n    } else {\n      throw new AbortError({bold: \"Version couldn't be created.\"}, null, [], customSections)\n    }\n  }\n\n  const validationErrors = result.appDeploy.appVersion.appModuleVersions\n    .filter((ver) => ver.validationErrors.length > 0)\n    .map((ver) => {\n      return {uuid: ver.registrationUuid, errors: ver.validationErrors}\n    })\n\n  return {\n    validationErrors,\n    versionTag: result.appDeploy.appVersion.versionTag,\n    location: result.appDeploy.appVersion.location,\n    message: result.appDeploy.appVersion.message,\n    deployError,\n  }\n}\n\nconst VALIDATION_ERRORS_TITLE = '\\nValidation errors'\nconst GENERIC_ERRORS_TITLE = '\\n'\n\nexport function deploymentErrorsToCustomSections(\n  errors: AppDeploySchema['appDeploy']['userErrors'],\n  extensionIds: IdentifiersExtensions,\n  flags: {\n    version?: string\n  } = {},\n): ErrorCustomSection[] {\n  const isExtensionError = (error: (typeof errors)[0]) => {\n    return error.details?.some((detail) => detail.extension_id) ?? false\n  }\n\n  const isCliError = (error: (typeof errors)[0], extensionIds: IdentifiersExtensions) => {\n    const errorExtensionId =\n      error.details?.find((detail) => typeof detail.extension_id !== 'undefined')?.extension_id.toString() ?? ''\n\n    return Object.values(extensionIds).includes(errorExtensionId)\n  }\n\n  const [extensionErrors, nonExtensionErrors] = partition(errors, (error) => isExtensionError(error))\n\n  const [cliErrors, partnersErrors] = partition(extensionErrors, (error) => isCliError(error, extensionIds))\n\n  const customSections = [\n    ...generalErrorsSection(nonExtensionErrors, {version: flags.version}),\n    ...cliErrorsSections(cliErrors, extensionIds),\n    ...partnersErrorsSections(partnersErrors),\n  ]\n  return customSections\n}\n\nfunction generalErrorsSection(errors: AppDeploySchema['appDeploy']['userErrors'], flags: {version?: string} = {}) {\n  if (errors.length > 0) {\n    if (\n      errors.filter((error) => error.field.includes('version_tag') && error.message === 'has already been taken')\n        .length > 0 &&\n      flags.version\n    ) {\n      return [\n        {\n          body: [\n            'An app version with the name',\n            {userInput: flags.version},\n            'already exists. Deploy again with a different version name.',\n          ],\n        },\n      ]\n    }\n\n    if (errors.length === 1) {\n      return [\n        {\n          body: errors[0]!.message,\n        },\n      ]\n    }\n\n    return [\n      {\n        body: {\n          list: {\n            items: errors.map((error) => error.message),\n          },\n        },\n      },\n    ]\n  } else {\n    return []\n  }\n}\n\nfunction cliErrorsSections(errors: AppDeploySchema['appDeploy']['userErrors'], identifiers: IdentifiersExtensions) {\n  return errors.reduce((sections, error) => {\n    const field = error.field.join('.').replace('extension_points', 'extensions.targeting')\n    const errorMessage = field === 'base' ? error.message : `${field}: ${error.message}`\n\n    const remoteTitle = error.details.find((detail) => typeof detail.extension_title !== 'undefined')?.extension_title\n    const extensionIdentifier = error.details\n      .find((detail) => typeof detail.extension_id !== 'undefined')\n      ?.extension_id.toString()\n\n    const handle = Object.keys(identifiers).find((key) => identifiers[key] === extensionIdentifier)\n    const extensionName = handle ?? remoteTitle\n\n    const existingSection = sections.find((section) => section.title === extensionName)\n\n    if (existingSection) {\n      const sectionBody = existingSection.body as ListToken[]\n      const errorsList =\n        error.category === 'invalid'\n          ? sectionBody.find((listToken) => listToken.list.title === VALIDATION_ERRORS_TITLE)\n          : sectionBody.find((listToken) => listToken.list.title === GENERIC_ERRORS_TITLE)\n\n      if (errorsList) {\n        errorsList.list.items.push(errorMessage)\n      } else {\n        sectionBody.push({\n          list: {\n            title: error.category === 'invalid' ? VALIDATION_ERRORS_TITLE : GENERIC_ERRORS_TITLE,\n            items: [errorMessage],\n          },\n        })\n      }\n    } else {\n      sections.push({\n        title: extensionName,\n        body: [\n          {\n            list: {\n              title: error.category === 'invalid' ? VALIDATION_ERRORS_TITLE : GENERIC_ERRORS_TITLE,\n              items: [errorMessage],\n            },\n          },\n        ],\n      })\n    }\n\n    sections.forEach((section) => {\n      // eslint-disable-next-line id-length\n      ;(section.body as ListToken[]).sort((a, b) => {\n        if (a.list.title === VALIDATION_ERRORS_TITLE) {\n          return 1\n        }\n\n        if (b.list.title === VALIDATION_ERRORS_TITLE) {\n          return -1\n        }\n\n        return 0\n      })\n    })\n\n    return sections\n  }, [] as ErrorCustomSection[])\n}\n\nfunction partnersErrorsSections(errors: AppDeploySchema['appDeploy']['userErrors']) {\n  return errors\n    .reduce((sections, error) => {\n      const extensionIdentifier = error.details.find(\n        (detail) => typeof detail.extension_title !== 'undefined',\n      )?.extension_title\n\n      const existingSection = sections.find((section) => section.title === extensionIdentifier)\n\n      if (existingSection) {\n        existingSection.errorCount += 1\n      } else {\n        sections.push({\n          title: extensionIdentifier,\n          errorCount: 1,\n        })\n      }\n\n      return sections\n    }, [] as {title: string | undefined; errorCount: number}[])\n    .map((section) => ({\n      title: section.title,\n      body: `\\n${section.errorCount} error${\n        section.errorCount > 1 ? 's' : ''\n      } found in your extension. Fix these issues in the Partner Dashboard and try deploying again.`,\n    })) as ErrorCustomSection[]\n}\n\n/**\n * It generates a URL to upload an app bundle.\n * @param apiKey - The application API key\n */\nexport async function getExtensionUploadURL(apiKey: string) {\n  const mutation = GenerateSignedUploadUrl\n  const token = await ensureAuthenticatedPartners()\n  const variables: GenerateSignedUploadUrlVariables = {\n    apiKey,\n    bundleFormat: 1,\n  }\n\n  const result: GenerateSignedUploadUrlSchema = await handlePartnersErrors(() =>\n    partnersRequest(mutation, token, variables),\n  )\n\n  if (result.appVersionGenerateSignedUploadUrl?.userErrors?.length > 0) {\n    const errors = result.appVersionGenerateSignedUploadUrl.userErrors.map((error) => error.message).join(', ')\n    throw new AbortError(errors)\n  }\n\n  return result.appVersionGenerateSignedUploadUrl.signedUploadUrl\n}\n\ninterface UploadFunctionExtensionsOptions {\n  /** The token to send authenticated requests to the partners' API  */\n  token: string\n\n  // Set of local identifiers\n  identifiers: Identifiers\n}\n\n/**\n * This function takes a list of function extensions and uploads them.\n * As part of the upload it creates a function server-side if it does not exist\n * and includes its remote identifier in the returned identifiers instance.\n * If the function already has a local id, that one is used and the upload\n * does an override of the function existing server-side.\n *\n * @param extensions - The list of extensions to upload.\n * @param options - Options to adjust the upload.\n * @returns A promise that resolves with the identifiers.\n */\nexport async function uploadFunctionExtensions(\n  extensions: ExtensionInstance<FunctionConfigType>[],\n  options: UploadFunctionExtensionsOptions,\n): Promise<Identifiers> {\n  let identifiers = options.identifiers\n\n  const functionIds: IdentifiersExtensions = {}\n\n  // Functions are uploaded sequentially to avoid reaching the API limit\n  for (const extension of extensions) {\n    // eslint-disable-next-line no-await-in-loop\n    const remoteIdentifier = await uploadFunctionExtension(extension, {\n      apiKey: options.identifiers.app,\n      token: options.token,\n      identifier: identifiers.extensions[extension.localIdentifier],\n    })\n    functionIds[extension.localIdentifier] = remoteIdentifier\n  }\n\n  identifiers = {\n    ...identifiers,\n    extensions: {\n      ...identifiers.extensions,\n      ...functionIds,\n    },\n  }\n\n  return identifiers\n}\n\ninterface UploadFunctionExtensionOptions {\n  apiKey: string\n  identifier?: string\n  token: string\n}\n\nasync function uploadFunctionExtension(\n  extension: ExtensionInstance<FunctionConfigType>,\n  options: UploadFunctionExtensionOptions,\n): Promise<string> {\n  const {url} = await uploadWasmBlob(extension.localIdentifier, extension.outputPath, options.apiKey, options.token)\n\n  let inputQuery: string | undefined\n  if (await fileExists(extension.inputQueryPath)) {\n    inputQuery = await readFile(extension.inputQueryPath)\n  }\n\n  const query = AppFunctionSetMutation\n  const variables: AppFunctionSetVariables = {\n    // NOTE: This is a shim to support CLI projects that currently use the UUID instead of the ULID\n    ...(options.identifier?.includes('-') ? {legacyUuid: options.identifier} : {id: options.identifier}),\n    title: extension.configuration.name,\n    description: extension.configuration.description ?? '',\n    apiType: extension.configuration.type,\n    apiVersion: extension.configuration.api_version,\n    inputQuery,\n    inputQueryVariables: extension.configuration.input?.variables\n      ? {\n          singleJsonMetafield: extension.configuration.input.variables,\n        }\n      : undefined,\n    appBridge: extension.configuration.ui?.paths\n      ? {\n          detailsPath: extension.configuration.ui.paths.details,\n          createPath: extension.configuration.ui.paths.create,\n        }\n      : undefined,\n    enableCreationUi: extension.configuration.ui?.enable_create ?? true,\n    moduleUploadUrl: url,\n  }\n\n  const res: AppFunctionSetMutationSchema = await functionProxyRequest(options.apiKey, query, options.token, variables)\n  const userErrors = res.data.functionSet.userErrors ?? []\n  if (userErrors.length !== 0) {\n    if (userErrors.find((error) => error.tag === 'version_unsupported_error')) {\n      const errorMessage = outputContent`Deployment failed due to an outdated API version`\n      const tryMessage: TokenItem = {\n        subdued: `Deployment failed because one or more Functions (${variables.apiType}) is targeting an unsupported API version (${variables.apiVersion}).`,\n      }\n      const customSections: AlertCustomSection[] = [\n        {\n          body: {\n            list: {\n              title: 'Reference',\n              items: [\n                {\n                  link: {\n                    label: 'API versioning',\n                    url: 'https://shopify.dev/docs/api/usage/versioning',\n                  },\n                },\n              ],\n            },\n          },\n        },\n      ]\n      throw new AbortError(errorMessage, tryMessage, [], customSections)\n    } else {\n      const errorMessage = outputContent`The deployment of functions failed with the following errors:${outputToken.json(\n        userErrors,\n      )}`\n      throw new AbortError(errorMessage)\n    }\n  }\n  return res.data.functionSet.function?.id as string\n}\n\nexport async function uploadWasmBlob(\n  extensionIdentifier: string,\n  wasmPath: string,\n  apiKey: string,\n  token: string,\n): Promise<{url: string; moduleId: string}> {\n  const {url, moduleId, headers, maxSize} = await getFunctionExtensionUploadURL({apiKey, token})\n  headers['Content-Type'] = 'application/wasm'\n\n  const functionContent = await readFile(wasmPath, {})\n  const res = await fetch(url, {body: functionContent, headers, method: 'PUT'})\n  const resBody = res.body?.read()?.toString() || ''\n\n  if (res.status === 200) {\n    return {url, moduleId}\n  } else if (res.status === 400 && resBody.includes('EntityTooLarge')) {\n    const errorMessage = outputContent`The size of the Wasm binary file for Function ${extensionIdentifier} is too large. It must be less than ${maxSize}.`\n    throw new AbortError(errorMessage)\n  } else if (res.status >= 400 && res.status < 500) {\n    const errorMessage = outputContent`Something went wrong uploading the Function ${extensionIdentifier}. The server responded with status ${res.status.toString()} and body: ${resBody}`\n    throw new BugError(errorMessage)\n  } else {\n    const errorMessage = outputContent`Something went wrong uploading the Function ${extensionIdentifier}. Try again.`\n    throw new AbortError(errorMessage)\n  }\n}\n\ninterface GetFunctionExtensionUploadURLOptions {\n  apiKey: string\n  token: string\n}\n\ninterface GetFunctionExtensionUploadURLOutput {\n  url: string\n  moduleId: string\n  maxSize: string\n  headers: {[key: string]: string}\n}\n\nasync function getFunctionExtensionUploadURL(\n  options: GetFunctionExtensionUploadURLOptions,\n): Promise<GetFunctionExtensionUploadURLOutput> {\n  const res: UploadUrlGenerateMutationSchema = await handlePartnersErrors(() =>\n    functionProxyRequest(options.apiKey, UploadUrlGenerateMutation, options.token),\n  )\n  return res.data.uploadUrlGenerate\n}\n\nasync function handlePartnersErrors<T>(request: () => Promise<T>): Promise<T> {\n  try {\n    const result = await request()\n    return result\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  } catch (error: any) {\n    if (error.errors?.[0]?.extensions?.type === 'unsupported_client_version') {\n      const packageManager = await getPackageManager(cwd())\n\n      throw new AbortError(['Upgrade your CLI version to run the', {command: 'deploy'}, 'command.'], null, [\n        ['Run', {command: formatPackageManagerCommand(packageManager, 'shopify upgrade')}],\n      ])\n    }\n\n    throw error\n  }\n}\n"]}