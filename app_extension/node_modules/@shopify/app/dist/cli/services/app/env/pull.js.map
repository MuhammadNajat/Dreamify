{"version":3,"file":"pull.js","sourceRoot":"","sources":["../../../../../src/cli/services/app/env/pull.ts"],"names":[],"mappings":"AAAA,OAAO,EAAe,YAAY,EAAC,MAAM,4BAA4B,CAAA;AACrE,OAAO,EAAC,0BAA0B,EAAC,MAAM,uCAAuC,CAAA;AAChF,OAAO,EAAC,YAAY,EAAC,MAAM,+BAA+B,CAAA;AAC1D,OAAO,EAAC,SAAS,EAAC,MAAM,MAAM,CAAA;AAC9B,OAAO,EAAC,UAAU,EAAE,QAAQ,EAAE,SAAS,EAAC,MAAM,0BAA0B,CAAA;AACxE,OAAO,EAAgB,aAAa,EAAE,WAAW,EAAC,MAAM,8BAA8B,CAAA;AAMtF,MAAM,CAAC,KAAK,UAAU,OAAO,CAAC,GAAiB,EAAE,EAAC,OAAO,EAAiB;IACxE,OAAO,aAAa,CAAC,GAAG,EAAE,OAAO,CAAC,CAAA;AACpC,CAAC;AAED,MAAM,CAAC,KAAK,UAAU,aAAa,CAAC,GAAiB,EAAE,OAAkC;IACvF,MAAM,MAAM,GAAG,MAAM,0BAA0B,CAAC,GAAG,CAAC,CAAA;IAEpD,MAAM,aAAa,GAAG;QACpB,eAAe,EAAE,MAAM,CAAC,MAAM;QAC9B,kBAAkB,EAAE,MAAM,CAAC,aAAa,CAAC,CAAC,CAAC,EAAE,MAAM;QACnD,MAAM,EAAE,YAAY,CAAC,GAAG,CAAC,aAAa,CAAC;KACxC,CAAA;IAED,IAAI,MAAM,UAAU,CAAC,OAAO,CAAC,EAAE;QAC7B,MAAM,cAAc,GAAG,MAAM,QAAQ,CAAC,OAAO,CAAC,CAAA;QAC9C,MAAM,qBAAqB,GAAG,YAAY,CAAC,cAAc,EAAE,aAAa,CAAC,CAAA;QAEzE,IAAI,qBAAqB,KAAK,cAAc,EAAE;YAC5C,OAAO,aAAa,CAAA,iBAAiB,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAA;SACjE;aAAM;YACL,MAAM,SAAS,CAAC,OAAO,EAAE,qBAAqB,CAAC,CAAA;YAE/C,MAAM,IAAI,GAAG,SAAS,CAAC,cAAc,IAAI,EAAE,EAAE,qBAAqB,CAAC,CAAA;YACnE,OAAO,aAAa,CAAA,WAAW,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC;;EAE5D,qBAAqB;;;;EAIrB,WAAW,CAAC,SAAS,CAAC,IAAI,CAAC;GAC1B,CAAA;SACE;KACF;SAAM;QACL,MAAM,iBAAiB,GAAG,YAAY,CAAC,IAAI,EAAE,aAAa,CAAC,CAAA;QAE3D,MAAM,SAAS,CAAC,OAAO,EAAE,iBAAiB,CAAC,CAAA;QAE3C,OAAO,aAAa,CAAA,WAAW,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC;;EAE1D,iBAAiB;CAClB,CAAA;KACE;AACH,CAAC","sourcesContent":["import {AppInterface, getAppScopes} from '../../../models/app/app.js'\nimport {fetchAppFromConfigOrSelect} from '../fetch-app-from-config-or-select.js'\nimport {patchEnvFile} from '@shopify/cli-kit/node/dot-env'\nimport {diffLines} from 'diff'\nimport {fileExists, readFile, writeFile} from '@shopify/cli-kit/node/fs'\nimport {OutputMessage, outputContent, outputToken} from '@shopify/cli-kit/node/output'\n\ninterface PullEnvOptions {\n  envFile: string\n}\n\nexport async function pullEnv(app: AppInterface, {envFile}: PullEnvOptions): Promise<OutputMessage> {\n  return updateEnvFile(app, envFile)\n}\n\nexport async function updateEnvFile(app: AppInterface, envFile: PullEnvOptions['envFile']): Promise<OutputMessage> {\n  const orgApp = await fetchAppFromConfigOrSelect(app)\n\n  const updatedValues = {\n    SHOPIFY_API_KEY: orgApp.apiKey,\n    SHOPIFY_API_SECRET: orgApp.apiSecretKeys[0]?.secret,\n    SCOPES: getAppScopes(app.configuration),\n  }\n\n  if (await fileExists(envFile)) {\n    const envFileContent = await readFile(envFile)\n    const updatedEnvFileContent = patchEnvFile(envFileContent, updatedValues)\n\n    if (updatedEnvFileContent === envFileContent) {\n      return outputContent`No changes to ${outputToken.path(envFile)}`\n    } else {\n      await writeFile(envFile, updatedEnvFileContent)\n\n      const diff = diffLines(envFileContent ?? '', updatedEnvFileContent)\n      return outputContent`Updated ${outputToken.path(envFile)} to be:\n\n${updatedEnvFileContent}\n\nHere's what changed:\n\n${outputToken.linesDiff(diff)}\n  `\n    }\n  } else {\n    const newEnvFileContent = patchEnvFile(null, updatedValues)\n\n    await writeFile(envFile, newEnvFileContent)\n\n    return outputContent`Created ${outputToken.path(envFile)}:\n\n${newEnvFileContent}\n`\n  }\n}\n"]}