{"version":3,"file":"web_pixel_extension.js","sourceRoot":"","sources":["../../../../../src/cli/models/extensions/specifications/web_pixel_extension.ts"],"names":[],"mappings":"AAAA,OAAO,EAAC,4BAA4B,EAAC,MAAM,qBAAqB,CAAA;AAChE,OAAO,EAAC,UAAU,EAAC,MAAM,eAAe,CAAA;AACxC,OAAO,EAAC,GAAG,EAAC,MAAM,8BAA8B,CAAA;AAChD,OAAO,EAAC,UAAU,EAAC,MAAM,6BAA6B,CAAA;AACtD,OAAO,EAAC,QAAQ,EAAC,MAAM,0BAA0B,CAAA;AAEjD,MAAM,SAAS,GAAG,IAAI,CAAA;AACtB,MAAM,oBAAoB,GAAG,GAAG,CAAA;AAChC,MAAM,iBAAiB,GAAG,oBAAoB,GAAG,SAAS,CAAA;AAE1D,MAAM,UAAU,GAAG,+BAA+B,CAAA;AAElD,MAAM,cAAc,GAAG,UAAU,CAAC,MAAM,CAAC;IACvC,eAAe,EAAE,GAAG,CAAC,MAAM,EAAE;IAC7B,OAAO,EAAE,GAAG,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;IAChC,aAAa,EAAE,GAAG,CAAC,GAAG,EAAE;IACxB,QAAQ,EAAE,GAAG,CAAC,GAAG,EAAE;CACpB,CAAC,CAAA;AAEF,MAAM,IAAI,GAAG,4BAA4B,CAAC;IACxC,UAAU,EAAE,qBAAqB;IACjC,UAAU;IACV,qBAAqB,EAAE,WAAW;IAClC,MAAM,EAAE,cAAc;IACtB,iBAAiB,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,UAAU,EAAE,SAAS,EAAE,sBAAsB,CAAC;IACzE,YAAY,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,EAAE,EAAE;QAChC,OAAO;YACL,eAAe,EAAE,MAAM,CAAC,eAAe;YACvC,gCAAgC,EAAE,MAAM,CAAC,QAAQ;SAClD,CAAA;IACH,CAAC;IACD,eAAe,EAAE,KAAK,EAAE,SAAS,EAAE,EAAE;QACnC,MAAM,UAAU,GAAG,MAAM,QAAQ,CAAC,SAAS,CAAC,UAAU,CAAC,CAAA;QACvD,IAAI,UAAU,GAAG,iBAAiB,EAAE;YAClC,MAAM,uBAAuB,GAAG,GAAG,CAAC,UAAU,GAAG,SAAS,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,KAAK,CAAA;YAC3E,MAAM,IAAI,UAAU,CAClB,+DAA+D,oBAAoB,wBAAwB,uBAAuB,GAAG,EACrI,4CAA4C,CAC7C,CAAA;SACF;IACH,CAAC;IACD,mBAAmB,EAAE,KAAK,EAAE,SAAS,EAAE,EAAE;QACvC,IAAI,SAAS,CAAC,aAAa,CAAC,aAAa,EAAE;YACzC,MAAM,IAAI,UAAU,CAClB,mEAAmE,EACnE,mCAAmC,CACpC,CAAA;SACF;QACD,OAAO,OAAO,CAAC,OAAO,EAAE,CAAA;IAC1B,CAAC;CACF,CAAC,CAAA;AAEF,eAAe,IAAI,CAAA","sourcesContent":["import {createExtensionSpecification} from '../specification.js'\nimport {BaseSchema} from '../schemas.js'\nimport {zod} from '@shopify/cli-kit/node/schema'\nimport {AbortError} from '@shopify/cli-kit/node/error'\nimport {fileSize} from '@shopify/cli-kit/node/fs'\n\nconst kilobytes = 1024\nconst BUNDLE_SIZE_LIMIT_KB = 128\nconst BUNDLE_SIZE_LIMIT = BUNDLE_SIZE_LIMIT_KB * kilobytes\n\nconst dependency = '@shopify/web-pixels-extension'\n\nconst WebPixelSchema = BaseSchema.extend({\n  runtime_context: zod.string(),\n  version: zod.string().optional(),\n  configuration: zod.any(),\n  settings: zod.any(),\n})\n\nconst spec = createExtensionSpecification({\n  identifier: 'web_pixel_extension',\n  dependency,\n  partnersWebIdentifier: 'web_pixel',\n  schema: WebPixelSchema,\n  appModuleFeatures: (_) => ['bundling', 'esbuild', 'single_js_entry_path'],\n  deployConfig: async (config, _) => {\n    return {\n      runtime_context: config.runtime_context,\n      runtime_configuration_definition: config.settings,\n    }\n  },\n  buildValidation: async (extension) => {\n    const bundleSize = await fileSize(extension.outputPath)\n    if (bundleSize > BUNDLE_SIZE_LIMIT) {\n      const humanReadableBundleSize = `${(bundleSize / kilobytes).toFixed(2)} kB`\n      throw new AbortError(\n        `Your web pixel extension exceeds the total file size limit (${BUNDLE_SIZE_LIMIT_KB} kB). It's currently ${humanReadableBundleSize}.`,\n        `Reduce your total file size and try again.`,\n      )\n    }\n  },\n  preDeployValidation: async (extension) => {\n    if (extension.configuration.configuration) {\n      throw new AbortError(\n        `The property configuration is deprecated and no longer supported.`,\n        `It has been replaced by settings.`,\n      )\n    }\n    return Promise.resolve()\n  },\n})\n\nexport default spec\n"]}