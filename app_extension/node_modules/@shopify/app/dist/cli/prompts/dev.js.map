{"version":3,"file":"dev.js","sourceRoot":"","sources":["../../../src/cli/prompts/dev.ts"],"names":[],"mappings":"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","sourcesContent":["import {Organization, MinimalOrganizationApp, OrganizationStore} from '../models/organization.js'\nimport {fetchOrgAndApps, OrganizationAppsResponse} from '../services/dev/fetch.js'\nimport {getTomls} from '../utilities/app/config/getTomls.js'\nimport {setCachedCommandInfo} from '../services/local-storage.js'\nimport {PartnersSession} from '../services/context/partner-account-info.js'\nimport {renderAutocompletePrompt, renderConfirmationPrompt, renderTextPrompt} from '@shopify/cli-kit/node/ui'\nimport {outputCompleted} from '@shopify/cli-kit/node/output'\n\nexport async function selectOrganizationPrompt(organizations: Organization[]): Promise<Organization> {\n  if (organizations.length === 1) {\n    return organizations[0]!\n  }\n  const orgList = organizations.map((org) => ({label: org.businessName, value: org.id}))\n  const id = await renderAutocompletePrompt({\n    message: 'Which Partners organization is this work for?',\n    choices: orgList,\n  })\n  return organizations.find((org) => org.id === id)!\n}\n\nexport async function selectAppPrompt(\n  apps: OrganizationAppsResponse,\n  orgId: string,\n  partnersSession: PartnersSession,\n  options?: {\n    directory?: string\n  },\n): Promise<string> {\n  const tomls = await getTomls(options?.directory)\n\n  if (tomls) setCachedCommandInfo({tomls})\n\n  const toAnswer = (app: MinimalOrganizationApp) => {\n    if (tomls[app?.apiKey]) {\n      return {label: `${app.title} (${tomls[app.apiKey]})`, value: app.apiKey}\n    }\n\n    return {label: app.title, value: app.apiKey}\n  }\n\n  const appList = apps.nodes.map(toAnswer)\n\n  return renderAutocompletePrompt({\n    message: 'Which existing app is this for?',\n    choices: appList,\n    hasMorePages: apps.pageInfo.hasNextPage,\n    search: async (term) => {\n      const result = await fetchOrgAndApps(orgId, partnersSession, term)\n\n      return {\n        data: result.apps.nodes.map(toAnswer),\n        meta: {\n          hasNextPage: result.apps.pageInfo.hasNextPage,\n        },\n      }\n    },\n  })\n}\n\nexport async function selectStorePrompt(stores: OrganizationStore[]): Promise<OrganizationStore | undefined> {\n  if (stores.length === 0) return undefined\n  if (stores.length === 1) {\n    outputCompleted(`Using your default dev store, ${stores[0]!.shopName}, to preview your project.`)\n    return stores[0]\n  }\n  const storeList = stores.map((store) => ({label: store.shopName, value: store.shopId}))\n\n  const id = await renderAutocompletePrompt({\n    message: 'Which store would you like to use to view your project?',\n    choices: storeList,\n  })\n  return stores.find((store) => store.shopId === id)\n}\n\nexport async function appNamePrompt(currentName: string): Promise<string> {\n  return renderTextPrompt({\n    message: 'App name',\n    defaultValue: currentName,\n    validate: (value) => {\n      if (value.length === 0) {\n        return \"App name can't be empty\"\n      }\n      if (value.length > 30) {\n        return 'Enter a shorter name (30 character max.)'\n      }\n      if (value.includes('shopify')) {\n        return 'Name can\\'t contain \"shopify.\" Enter another name.'\n      }\n    },\n  })\n}\n\nexport async function reloadStoreListPrompt(org: Organization): Promise<boolean> {\n  return renderConfirmationPrompt({\n    message: 'Finished creating a dev store?',\n    confirmationMessage: `Yes, ${org.businessName} has a new dev store`,\n    cancellationMessage: 'No, cancel dev',\n  })\n}\n\nexport async function createAsNewAppPrompt(): Promise<boolean> {\n  return renderConfirmationPrompt({\n    message: 'Create this project as a new app on Shopify?',\n    confirmationMessage: 'Yes, create it as a new app',\n    cancellationMessage: 'No, connect it to an existing app',\n  })\n}\n\nexport async function reuseDevConfigPrompt(): Promise<boolean> {\n  return renderConfirmationPrompt({\n    message: 'Deploy to the same org and app as you used for dev?',\n    confirmationMessage: 'Yes, deploy in the same way',\n    cancellationMessage: 'No, use a different org or app',\n  })\n}\n\nexport function updateURLsPrompt(currentAppUrl: string, currentRedirectUrls: string[]): Promise<boolean> {\n  return renderConfirmationPrompt({\n    message: \"Have Shopify automatically update your app's URL in order to create a preview experience?\",\n    confirmationMessage: 'Yes, automatically update',\n    cancellationMessage: 'No, never',\n    infoTable: {\n      'Current app URL': [currentAppUrl],\n      'Current redirect URLs': currentRedirectUrls,\n    },\n  })\n}\n"]}