{"version":3,"file":"DangerousConfirmationPrompt.test.js","sourceRoot":"","sources":["../../../../../src/private/node/ui/components/DangerousConfirmationPrompt.test.tsx"],"names":[],"mappings":"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","sourcesContent":["import {DangerousConfirmationPrompt} from './DangerousConfirmationPrompt.js'\nimport {getLastFrameAfterUnmount, sendInputAndWaitForChange, waitForInputsToBeReady, render} from '../../testing/ui.js'\nimport {unstyled} from '../../../../public/node/output.js'\nimport React from 'react'\nimport {describe, expect, test, vi} from 'vitest'\n\nconst ENTER = '\\r'\nconst ESC = '\\x1b'\n\ndescribe('DangerousConfirmationPrompt', () => {\n  test('default state', () => {\n    const {lastFrame} = render(\n      <DangerousConfirmationPrompt onSubmit={() => {}} message=\"Test question\" confirmation=\"yes\" />,\n    )\n\n    expect(unstyled(lastFrame()!)).toMatchInlineSnapshot(`\n      \"?  Test question:\n\n         Type yes to confirm, or press Escape to cancel.\n      >  █\n         ▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔\n      \"\n    `)\n  })\n\n  test('default validation error', async () => {\n    const renderInstance = render(\n      <DangerousConfirmationPrompt onSubmit={() => {}} message=\"Test question\" confirmation=\"yes\" />,\n    )\n\n    await waitForInputsToBeReady()\n    await sendInputAndWaitForChange(renderInstance, ENTER)\n    // testing with styles because the color changes to red\n    expect(renderInstance.lastFrame()).toMatchInlineSnapshot(`\n      \"?  Test question:\n\n         Type \u001b[36myes\u001b[39m to confirm, or press Escape to cancel.\n      \u001b[31m>\u001b[39m  \u001b[31m\u001b[41m█\u001b[49m\u001b[39m\n         \u001b[31m▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔\u001b[39m\n         \u001b[31mValue must be exactly \u001b[36myes\u001b[39m\n      \"\n    `)\n    await sendInputAndWaitForChange(renderInstance, 'A')\n    // color changes back to valid color\n    expect(renderInstance.lastFrame()).toMatchInlineSnapshot(`\n      \"?  Test question:\n\n         Type \u001b[36myes\u001b[39m to confirm, or press Escape to cancel.\n      \u001b[36m>\u001b[39m  \u001b[36mA\u001b[46m█\u001b[49m\u001b[39m\n         \u001b[36m▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔\u001b[39m\n      \"\n    `)\n  })\n\n  test('submitting the value', async () => {\n    const onSubmit = vi.fn()\n    const renderInstance = render(\n      <DangerousConfirmationPrompt onSubmit={onSubmit} message=\"Test question\" confirmation=\"yes\" />,\n    )\n\n    await waitForInputsToBeReady()\n    await sendInputAndWaitForChange(renderInstance, 'yes')\n    await sendInputAndWaitForChange(renderInstance, ENTER)\n    expect(onSubmit).toHaveBeenCalledWith(true)\n    expect(unstyled(getLastFrameAfterUnmount(renderInstance)!)).toMatchInlineSnapshot(`\n      \"?  Test question:\n      ✔  Confirmed\n      \"\n    `)\n  })\n\n  test('text wrapping', async () => {\n    // component width is 80 characters wide in tests but because of the question mark and\n    // spaces before the question, we only have 77 characters to work with\n    const renderInstance = render(\n      <DangerousConfirmationPrompt onSubmit={() => {}} message=\"Test question\" confirmation=\"yes\" />,\n    )\n\n    await waitForInputsToBeReady()\n    await sendInputAndWaitForChange(renderInstance, 'A'.repeat(77))\n    await sendInputAndWaitForChange(renderInstance, 'B'.repeat(6))\n    expect(renderInstance.lastFrame()).toMatchInlineSnapshot(`\n      \"?  Test question:\n\n         Type \u001b[36myes\u001b[39m to confirm, or press Escape to cancel.\n      \u001b[36m>\u001b[39m  \u001b[36mAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\u001b[39m\n         \u001b[36mBBBBBB\u001b[46m█\u001b[49m\u001b[39m\n         \u001b[36m▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔\u001b[39m\n      \"\n    `)\n  })\n\n  test(\"doesn't append a colon to the message if it ends with a question mark\", async () => {\n    const {lastFrame} = render(\n      <DangerousConfirmationPrompt onSubmit={() => {}} message=\"Test question?\" confirmation=\"yes\" />,\n    )\n\n    expect(unstyled(lastFrame()!)).toMatchInlineSnapshot(`\n      \"?  Test question?\n\n         Type yes to confirm, or press Escape to cancel.\n      >  █\n         ▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔\n      \"\n    `)\n  })\n\n  test('can use Escape key to exit the prompt gracefully', async () => {\n    const onSubmit = vi.fn()\n    const renderInstance = render(\n      <DangerousConfirmationPrompt onSubmit={onSubmit} message=\"Test question\" confirmation=\"yes\" />,\n    )\n    await waitForInputsToBeReady()\n    const promise = renderInstance.waitUntilExit()\n    await sendInputAndWaitForChange(renderInstance, ESC)\n\n    expect(unstyled(getLastFrameAfterUnmount(renderInstance)!)).toMatchInlineSnapshot(`\n      \"?  Test question:\n      ✘  Cancelled\n      \"\n    `)\n    await expect(promise).resolves.toEqual(undefined)\n    expect(onSubmit).toHaveBeenCalledWith(false)\n  })\n})\n"]}